<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>awk函数辨析</title>
      <link href="/2021/11/18/awk-ming-ling-bian-xi/"/>
      <url>/2021/11/18/awk-ming-ling-bian-xi/</url>
      
        <content type="html"><![CDATA[<h1 id="awk命名基础解析"><a href="#awk命名基础解析" class="headerlink" title="awk命名基础解析"></a>awk命名基础解析</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>awk会将传递过来的数据按照一个整体处理的</p><p>awk主要有三模块组成:(可以按照junit测试来理解.)</p><pre><code>BEGIN&#123;&#125;:开始执行前的准备阶段,可以理解为初始化PATTERN&#123;&#125;:操作命令END&#123;&#125;:操作结束后的处理,收尾工作.</code></pre><ul><li>样式<pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">awk <span class="token string">'BEGIN&#123;&#125;&#123;&#125;END&#123;&#125;'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><p>由此我们可以想到:    在BEGIN阶段用于指定按照什么分割传入过来的一行数据.</p><h2 id="不多BB直接上案例"><a href="#不多BB直接上案例" class="headerlink" title="不多BB直接上案例"></a>不多BB直接上案例</h2><br><ul><li>example<pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token comment"># 按照","分割 打印出第一列数据(下标从1开始)</span>awk <span class="token string">'BEGIN&#123;FS=","&#125;&#123;print $1&#125;'</span><span class="token comment"># 等价写法</span>awk <span class="token operator">-</span>F<span class="token punctuation">,</span> <span class="token string">'&#123;print $1&#125;'</span><span class="token comment"># 关于\t,就有了一些区别</span><span class="token comment"># 想如下这样写法</span>awk <span class="token operator">-</span>F\t <span class="token string">'&#123;print $1&#125;'</span><span class="token comment"># 这里的\他是识别不到的,直接把他理解成了t</span><span class="token comment"># 即:在他的理解里,当前是按照"t"为分割付进行处理的</span><span class="token comment"># auther: tzkTangXS</span><span class="token comment"># 那么就有两种处理办法</span><span class="token comment"># 1.在加上一个反斜杠"\"将这个原来的"\"转义一下,转义成"\"</span>awk <span class="token operator">-</span>F\\t <span class="token string">'&#123;print $1&#125;'</span><span class="token comment"># 2.第二种写法: 使用''号</span>awk <span class="token operator">-</span>F <span class="token string">'\t'</span> <span class="token string">'&#123;print $1&#125;'</span><span class="token comment"># 讲到了'',那么有一个点就可以提一下:</span><span class="token comment"># 多分割付操作.不多BB,看例题</span>awk <span class="token operator">-</span>F <span class="token string">'[ a]'</span> <span class="token string">'&#123;print $1&#125;'</span> tzkTest<span class="token comment"># 这句话的意识就是:</span><span class="token comment"># 读取tzkTest里的数据.首先按照空格来切割.</span><span class="token comment">#   再然后按照a类切割</span><span class="token comment">#   最后输出第一列</span><span class="token comment"># exmaple</span><span class="token comment"># 假如tzkTest里的数据是如下形式(按\t分割):</span><span class="token comment"># wo heng hao heng shuai</span><span class="token comment"># wo  ui  ni  lk  gs</span>awk <span class="token operator">-</span>F <span class="token string">'[\te]'</span> <span class="token string">'&#123;print $2&#125;'</span><span class="token comment"># terimal</span>huiawk <span class="token operator">-</span>F <span class="token string">'[\te]'</span> <span class="token string">'&#123;print $3&#125;'</span><span class="token comment"># terimal</span>ng<span class="token function">ni</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="常用参数解释"><a href="#常用参数解释" class="headerlink" title="常用参数解释"></a>常用参数解释</h2><ul><li>NR行数(官方语言)一以读出的记录数目</li><li>NF这一行的列数(字段数目)(官方语言)一条记录的字段数目</li><li>FS指定分隔符</li><li>$n指定第几列(字段)</li></ul>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
          <category> shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctrl+c,ctrl+z等指令解析</title>
      <link href="/2021/11/18/ctrl-z-ztrl-c-deng-ming-ling-jie-xi/"/>
      <url>/2021/11/18/ctrl-z-ztrl-c-deng-ming-ling-jie-xi/</url>
      
        <content type="html"><![CDATA[<h2 id="命令解析"><a href="#命令解析" class="headerlink" title="命令解析"></a>命令解析</h2><h3 id="ctrl-z"><a href="#ctrl-z" class="headerlink" title="ctrl+z"></a>ctrl+z</h3><ul><li><p>英文名:</p><p>suspend foreground process</p></li><li><p>详解:</p><p>发送SIGSTOP型号给前台进程组中的所有进程.</p><p>由名字可知,他是用于<strong>挂起前台进程</strong>的命令.那么就可以使用fg命令回复.</p></li><li><p>实用案例:</p><p>在使用vi编辑时,如果需要去使用shell命令了,可以使用ctrl+z进行挂起,然后再利用fg命令回到vi编辑界面.</p></li></ul><br><h3 id="ctrl-c"><a href="#ctrl-c" class="headerlink" title="ctrl+c"></a>ctrl+c</h3><ul><li>英文名:kill foreground process</li><li>详解:发送SIGINT 型号给前台进程组中的所有进程.<strong>强制终止程序的执行</strong></li></ul><h3 id="ctrl-d"><a href="#ctrl-d" class="headerlink" title="ctrl+d"></a>ctrl+d</h3><ul><li><p>解析:</p><p>一个特殊的二进制值:EOF.(结尾符).代表结束.</p><p>文件流也是EOF作为结尾.(数据流都是二进制?目前的理解.目前的计算机大部分都是二进制计算机,所以所有信号都是二进制的方式传递的)</p><p>**edit:**写到此处,想到了我们老师说过,以前也出现过三进制的计算机,但是由于成本太低赚不到钱所以就被淘汰了.这……..万恶的资本主义.</p></li><li><p>用例:</p><p>终止当前shell等等</p></li></ul><h3 id="ctrl"><a href="#ctrl" class="headerlink" title="ctrl+/"></a>ctrl+/</h3><ul><li>解析:发送SIGQUIT型号给前台进程组终止前台进程并<strong>生成core文件</strong></li></ul><h3 id="ctrl-s"><a href="#ctrl-s" class="headerlink" title="ctrl+s"></a>ctrl+s</h3><ul><li>解析:中断控制台输出</li></ul><h3 id="ctrl-q"><a href="#ctrl-q" class="headerlink" title="ctrl+q"></a>ctrl+q</h3><ul><li>解析:恢复控制台输出</li></ul><h3 id="ctrl-l"><a href="#ctrl-l" class="headerlink" title="ctrl-l"></a>ctrl-l</h3><ul><li>解析:=clean</li></ul><p>**edit:**以上这些控制字符均可通过stty -a 命令查看</p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
          <category> shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>适用所有情况的VM扩容(在做数仓时遇到的问题)</title>
      <link href="/2021/11/17/xu-ni-ji-kuo-rong/"/>
      <url>/2021/11/17/xu-ni-ji-kuo-rong/</url>
      
        <content type="html"><![CDATA[<p><strong>edti:</strong></p><ul><li>   <strong>起因:</strong> 在做数仓项目的时候,由于数据过多,划分的磁盘不够用了,需要在根目录下扩容.</li><li>   <strong>但是:</strong> 由于当初下载的是最小版centos,导致根本没有分组卷等等一些情况.网上的扩容方法并不适用于我.</li><li>   <strong>解决思路:</strong> 于是乎想到了,划分的是一块地址连续的空间,那么只要满足”/“的这块空间是扩容后空间的子集那么数据就没有问题了,至于紧随其后的swap分区,本身就是交换分区,从新在尾部再划一块给他就行了</li><li>   <strong>使用范围:</strong> 该方法适用于所有情况.</li></ul><h2 id="查看分区"><a href="#查看分区" class="headerlink" title="查看分区"></a>查看分区</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">lsblk -f<span class="token function">fdisk</span> -l<span class="token comment">#查看磁盘使用情况</span><span class="token function">df</span> -h<span class="token comment">#如果swap分区在根分区的下面，那么肯定要重新划分swap分区的。查看下swap分区的情况</span><span class="token function">free</span> -h<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="删除当前分区，并且重新划分大小"><a href="#删除当前分区，并且重新划分大小" class="headerlink" title="删除当前分区，并且重新划分大小"></a>删除当前分区，并且重新划分大小</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">fdisk</span> /dev/sda<span class="token comment">#查看分区</span>p<span class="token comment">#删除指定分区</span>d<span class="token comment">#选择你所要删除的分区序列号</span><span class="token comment">#添加新分区</span>n<span class="token comment">#选择相同序列好即可</span><span class="token comment">#重新分配大小，即：start --> end</span><span class="token comment">#写入分区操作</span>w<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h2><h3 id="查看分区格式"><a href="#查看分区格式" class="headerlink" title="查看分区格式"></a>查看分区格式</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">lsblk -f<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">reboot</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="更具分区类型执行以下"><a href="#更具分区类型执行以下" class="headerlink" title="更具分区类型执行以下"></a>更具分区类型执行以下</h2><h3 id="如果分区是-ext格式"><a href="#如果分区是-ext格式" class="headerlink" title="如果分区是 ext格式"></a>如果分区是 ext格式</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">resize2fs /dev/sda2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="如果分区是xfs格式"><a href="#如果分区是xfs格式" class="headerlink" title="如果分区是xfs格式"></a>如果分区是xfs格式</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">xfs_growfs /dev/sda2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="查看磁盘使用情况"><a href="#查看磁盘使用情况" class="headerlink" title="查看磁盘使用情况"></a>查看磁盘使用情况</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">df</span> -h<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="就此更目录扩容完成，但是如果你的swap分区的序列在你的更目录的下面，那么就需要重新划分一下swap分区。"><a href="#就此更目录扩容完成，但是如果你的swap分区的序列在你的更目录的下面，那么就需要重新划分一下swap分区。" class="headerlink" title="就此更目录扩容完成，但是如果你的swap分区的序列在你的更目录的下面，那么就需要重新划分一下swap分区。"></a>就此更目录扩容完成，但是如果你的swap分区的序列在你的更目录的下面，那么就需要重新划分一下swap分区。</h2><h2 id="查看swap分区"><a href="#查看swap分区" class="headerlink" title="查看swap分区"></a>查看swap分区</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">lsblk -f<span class="token function">free</span> -h<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>发现没有uuid,没有该分区，大小为0G</strong><br>制造swap分区</p><hr><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">mkswap</span> /dev/sda3<span class="token comment">#查看uuid</span>blkid /dev/sda3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="将这个写入-etc-fstab-并挂载所有"><a href="#将这个写入-etc-fstab-并挂载所有" class="headerlink" title="将这个写入/etc/fstab,并挂载所有"></a>将这个写入/etc/fstab,并挂载所有</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment">#将sda3的uuid改为当前新的uuid即可</span><span class="token function">vim</span> /etc/fstab<span class="token comment">#挂载所有</span><span class="token function">mount</span> -a<span class="token comment">#再次查看</span><span class="token function">free</span> -h<span class="token comment">#发现已经挂载了swap分区</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hive常用函数</title>
      <link href="/2021/11/17/chang-yong-han-shu/"/>
      <url>/2021/11/17/chang-yong-han-shu/</url>
      
        <content type="html"><![CDATA[<p>#nvl<br>select nvl(salary,0) from emp;<br>#时间函数<br>select date_format(‘2017-3-4’,’yyyy-mm-dd HH:mm:ss’);</p><ul><li><p>   select date_add(‘2017-6-29’,4);<br>terminal: 2017-7-3</p></li><li><p>   select date_add(‘2017-6-27’,-4);<br>terminal: 2017-6-23</p></li><li><p>   select datediff(‘2017-7-3’,’2017-6-29’);<br>terminal: 4</p></li><li><p>   select datediff(‘2017-6-29’,’2017-7-3’);<br>terminal: -4</p></li><li><p>   select regexp_replace(‘2019/07/03’,’/‘,’-‘);<br>terminal: 2019-07-03</p></li></ul><h1 id><a href="#" class="headerlink" title></a></h1><p>select sum(case sex when ‘男’  then 1 else 0 end) male_count,<br>sum(case sex when ‘女’ then 1 else 0 end) female_count<br>from emp group by deptno order by deptno;</p><p>#concat//行转列<br>##第一步 t1<br>select concat_sw(‘,’,xz,xx) xz_xx<br>from<br>emp;<br>##第二步t2<br>select<br>t1.xz_xx, concat_sw(‘|’,collect_set(t1.name))<br>from t1<br>group by t1.xz_xx;<br>##第三步:整合<br>select<br>t1.xz_xx, concat_sw(‘|’,collect_set(t1.name))<br>from<br>(<br>select concat_sw(‘,’,xz,xx) xz_xx<br>from<br>emp;<br>)    t1<br>group by t1.xz_xx;<br>#列转行<br>##explode 将hive中复杂的array 或 map 拆分<br>###example<br>create table if not exists movie_info(<br>movie_name string,<br>category array<string><br>)<br>row format delimited fields terminated by ‘\t’<br>collection items terminated by ‘,’</string></p><p>load data local inpath ‘/opt/module/datas/movie.txt’ into table into movie_info;</p><p>select<br>movie,<br>category_name<br>from<br>movie_info lateral view explode(category) table_tmp as category_name;</p><p>select<br>movie_name,<br>category_name<br>from<br>movie_info cateral view explode(category) table_tmp as catgory_name;<br>#窗口函数<br>##over():<br>指定分析函数工作窗口大小，随着行变化<br>####current row<br>####n preceding:    向前移动n行<br>####n following:    向后移动N行<br>####unbounded    启点<br>unbounded preceding<br>unbounded following<br>##lag(col,n);<br>##lead(col,n);<br>#ntile(n)    把有序分区的行分发到指定数据的组中，各个组有编号，编号从1开始。对于每一个ntile返回此行所属的组的编号。<br>create table if not exists business(<br>name string,<br>order_date date,<br>cost double<br>)<br>row format delimited fields terminated by ‘,’</p><p>load data local inpath ‘/opt/module/data/business’<br>into table business;<br>##查询2017-04购买过商品的顾客及总人数<br>select name,count(*) over()<br>from business<br>where substring(orderdate,1,7) = ‘2017-04’<br>group by name;<br>##查询顾客购买明细，及月购买总额。<br>select *,sum(cost) over(partitioned by month(order_date))<br>from<br>business;</p><h2 id="-1"><a href="#-1" class="headerlink" title></a></h2>]]></content>
      
      
      <categories>
          
          <category> hive </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hive </tag>
            
            <tag> function </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DQL-排序</title>
      <link href="/2021/11/17/dql-pai-xu/"/>
      <url>/2021/11/17/dql-pai-xu/</url>
      
        <content type="html"><![CDATA[<h1 id="order-by"><a href="#order-by" class="headerlink" title="order by"></a>order by</h1><p>全排序</p><p>reduce数只有一，不管设置没设置。</p><pre class="line-numbers language-hql" data-language="hql"><code class="language-hql">select d.name,e.name from dept d left join emp e on d.id &#x3D; e.deptId order by d.id;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="sort-by"><a href="#sort-by" class="headerlink" title="sort by"></a>sort by</h1><p>分区排序,通常与distribute by 连用</p><h2 id="查看reduce数"><a href="#查看reduce数" class="headerlink" title="查看reduce数"></a>查看reduce数</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">set mapreduce.job.reduces;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="设置reduce数"><a href="#设置reduce数" class="headerlink" title="设置reduce数"></a>设置reduce数</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">set mapreduce.job.reduces&#x3D;3;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><pre class="line-numbers language-hql" data-language="hql"><code class="language-hql">select * from dept sort by dept.deptno;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="distribute-by"><a href="#distribute-by" class="headerlink" title="distribute by"></a>distribute by</h1><p>设定以什么分区</p><h2 id="同样的设置reduce数"><a href="#同样的设置reduce数" class="headerlink" title="同样的设置reduce数"></a>同样的设置reduce数</h2><pre class="line-numbers language-none"><code class="language-none">set mapreduce.job.redueces&#x3D;6;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="distribute-by-sort-by"><a href="#distribute-by-sort-by" class="headerlink" title="distribute by + sort by;"></a>distribute by + sort by;</h2><pre class="line-numbers language-none"><code class="language-none">select d.no,d.name,e.no,e.name from dept d left join emp e on d.eno &#x3D; e.no distribute by dept.no sort by e.no;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="cluster-by"><a href="#cluster-by" class="headerlink" title="cluster by"></a>cluster by</h1><p>相当于使用同一标准的distribute by + sort by;<br>例如：</p><pre class="line-numbers language-none"><code class="language-none">select d.*,e.* from dept d left join emp e on d.eno &#x3D; e.nocluster by d.no;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">select d.*,e.* from dept d left join emp e on d.eno&#x3D;e.no distribute by d.no sort by d.no;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> hive </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DQL </tag>
            
            <tag> hive </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>开天窗与否的区别</title>
      <link href="/2021/11/17/kai-tian-chuang-yu-fou-de-qu-bie/"/>
      <url>/2021/11/17/kai-tian-chuang-yu-fou-de-qu-bie/</url>
      
        <content type="html"><![CDATA[<h1 id="关于开天窗与不开天窗的区别"><a href="#关于开天窗与不开天窗的区别" class="headerlink" title="关于开天窗与不开天窗的区别"></a>关于开天窗与不开天窗的区别</h1><p>使用 over()是对<strong>最终结果集</strong>进行开天窗。</p><p>如果不使用，即不开天窗。受到group by等函数影响。</p><h2 id="example"><a href="#example" class="headerlink" title="example:"></a>example:</h2><pre class="line-numbers language-hql" data-language="hql"><code class="language-hql">select name,count(1) from business where substring(orderdate,1,7) &#x3D; &#39;2017-04&#39;group by name;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="terminal"><a href="#terminal" class="headerlink" title="terminal:"></a>terminal:</h3><p>name    _c1<br>jack    1<br>mart    4</p><pre class="line-numbers language-hql" data-language="hql"><code class="language-hql">select name,count(1) over() from business where substring(orderdate,1,7) &#x3D; &#39;2017-04&#39;group by name;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="terminal-1"><a href="#terminal-1" class="headerlink" title="terminal:"></a>terminal:</h3><p>name    count_window_0<br>mart    2<br>jack    2</p><h2 id="business表"><a href="#business表" class="headerlink" title="business表"></a>business表</h2><p>jack,2017-01-01,10<br>tony,2017-01-02,15<br>jack,2017-02-03,23<br>tony,2017-01-04,29<br>jack,2017-01-05,46<br>jack,2017-04-06,42<br>tony,2017-01-07,50<br>jack,2017-01-08,55<br>mart,2017-04-08,62<br>mart,2017-04-09,68<br>neil,2017-05-10,12<br>mart,2017-04-11,75<br>neil,2017-06-12,80<br>mart,2017-04-13,94</p><h2 id="建表语句"><a href="#建表语句" class="headerlink" title="建表语句"></a>建表语句</h2><pre class="line-numbers language-hql" data-language="hql"><code class="language-hql">create table business(name string,orderdate string,cost int) ROW FORMAT DELIMITED FIELDS TERMINATED BY &#39;,&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> hive </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hive </tag>
            
            <tag> over() </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shell指令(电商数仓项目)</title>
      <link href="/2021/11/17/shell-jiao-ben/"/>
      <url>/2021/11/17/shell-jiao-ben/</url>
      
        <content type="html"><![CDATA[<h2 id="集群分发脚本"><a href="#集群分发脚本" class="headerlink" title="集群分发脚本"></a>集群分发脚本</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token shebang important">#!/bin/bash</span><span class="token comment">#使用方法:</span><span class="token comment">#第一个参数输入文件路径</span><span class="token comment">#如果只同步到一个服务器上就只要在第二个参数上填写服务器编号就行</span><span class="token comment">#如果是要同步一个范围的服务器,那么写上开始节点和结束节点就行</span><span class="token assign-left variable">num</span><span class="token operator">=</span><span class="token variable">$#</span><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$num</span> -lt <span class="token number">2</span> <span class="token punctuation">]</span><span class="token keyword">then</span>        <span class="token builtin class-name">echo</span> <span class="token string">'参数小于二,参数至少要两个'</span><span class="token keyword">else</span>        <span class="token assign-left variable">path</span><span class="token operator">=</span><span class="token variable">$1</span>        <span class="token keyword">if</span> <span class="token punctuation">[</span> -e <span class="token variable">$path</span> <span class="token punctuation">]</span>        <span class="token keyword">then</span>                <span class="token assign-left variable">fname</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">basename</span> $path<span class="token variable">`</span></span>                <span class="token assign-left variable">dname</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">cd</span> -P <span class="token punctuation">$(</span>dirname $path<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>                <span class="token assign-left variable">me</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">whoami</span><span class="token variable">`</span></span>                <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$num</span> -gt <span class="token number">2</span> <span class="token punctuation">]</span>                <span class="token keyword">then</span>                        <span class="token assign-left variable">startNode</span><span class="token operator">=</span><span class="token variable">$2</span>                        <span class="token assign-left variable">endNode</span><span class="token operator">=</span><span class="token variable">$3</span>                        <span class="token keyword">for</span><span class="token variable"><span class="token punctuation">((</span>i<span class="token operator">=</span>startNode<span class="token punctuation">;</span>i <span class="token operator">&lt;</span> endNode<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">))</span></span>                        <span class="token keyword">do</span>                                <span class="token builtin class-name">echo</span> <span class="token string">"======同步hadoop<span class="token variable">$i</span>======"</span>                                <span class="token function">rsync</span> -avl <span class="token variable">$dname</span>/<span class="token variable">$fname</span> <span class="token variable">$me</span>@hadoop<span class="token variable">$i</span><span class="token builtin class-name">:</span><span class="token variable">$dname</span>/                        <span class="token keyword">done</span>                <span class="token keyword">else</span>                                <span class="token builtin class-name">echo</span> <span class="token string">"======同步hadoop<span class="token variable">$2</span>======"</span>                                <span class="token function">rsync</span> -avl <span class="token variable">$dname</span>/<span class="token variable">$fname</span> <span class="token variable">$me</span>@hadoop<span class="token variable">$2</span><span class="token builtin class-name">:</span><span class="token variable">$dname</span>/                  <span class="token keyword">fi</span>         <span class="token keyword">else</span>                <span class="token builtin class-name">echo</span> <span class="token string">"没有<span class="token variable">$dname</span>/<span class="token variable">$fname</span>这个文件或目录或等等"</span>        <span class="token keyword">fi</span><span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="集群查看脚本"><a href="#集群查看脚本" class="headerlink" title="集群查看脚本"></a>集群查看脚本</h2><h3 id="xcall"><a href="#xcall" class="headerlink" title="xcall"></a>xcall</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop101 hadoop102 hadoop103<span class="token keyword">do</span>    <span class="token builtin class-name">echo</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token variable">$i</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>    <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">"<span class="token variable">$*</span>"</span><span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="集群启动脚本"><a href="#集群启动脚本" class="headerlink" title="集群启动脚本"></a>集群启动脚本</h2><h3 id="cluster-sh"><a href="#cluster-sh" class="headerlink" title="cluster.sh"></a>cluster.sh</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token shebang important">#!/bin/bash</span><span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span><span class="token string">"start"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token builtin class-name">echo</span> <span class="token string">"==============集群统一启动中============"</span>        <span class="token builtin class-name">echo</span> <span class="token string">"=======启动zookeeper======="</span>        zk start        <span class="token builtin class-name">echo</span> <span class="token string">"=====启动hadoop===="</span>        hdp start        <span class="token builtin class-name">echo</span> <span class="token string">"====启动Kafka======="</span>        kfk start        <span class="token builtin class-name">echo</span> <span class="token string">"======启动采集Flume====="</span>        f1 start        <span class="token builtin class-name">echo</span> <span class="token string">"========启动消费Flume========"</span>        f2 start<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token string">"stop"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token builtin class-name">echo</span> <span class="token string">"=========停止集群========="</span>        <span class="token builtin class-name">echo</span> <span class="token string">"=======停止消费Flume======"</span>        f2 stop        <span class="token builtin class-name">echo</span> <span class="token string">"=======停止采集Flume======"</span>        f1 stop        <span class="token builtin class-name">echo</span> <span class="token string">"=======停止Kafka======"</span>        kfk stop        <span class="token builtin class-name">echo</span> <span class="token string">"=======停止Hadoop======"</span>        hdp stop        <span class="token builtin class-name">echo</span> <span class="token string">"=======停止Zookeeper======"</span>        zk stop<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">esac</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="zk"><a href="#zk" class="headerlink" title="zk"></a>zk</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token shebang important">#!/bin/bash</span><span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span><span class="token string">"start"</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop101 hadoop102 hadoop103    <span class="token keyword">do</span>        <span class="token builtin class-name">echo</span> <span class="token string">"===========<span class="token variable">$i</span>=========="</span>        <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">"zkServer.sh start"</span>    <span class="token keyword">done</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token string">"stop"</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop101 hadoop102 hadoop103    <span class="token keyword">do</span>        <span class="token builtin class-name">echo</span> <span class="token string">"===========<span class="token variable">$i</span>=========="</span>        <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">"zkServer.sh stop"</span>    <span class="token keyword">done</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token string">"status"</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop101 hadoop102 hadoop103    <span class="token keyword">do</span>        <span class="token builtin class-name">echo</span> <span class="token string">"===========<span class="token variable">$i</span>=========="</span>        <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">"zkServer.sh status"</span>    <span class="token keyword">done</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">esac</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="hdp"><a href="#hdp" class="headerlink" title="hdp"></a>hdp</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token shebang important">#!/bin/bash</span><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> -lt <span class="token number">1</span> <span class="token punctuation">]</span><span class="token keyword">then</span>    <span class="token builtin class-name">echo</span> <span class="token string">"No Args Input..."</span>    <span class="token builtin class-name">exit</span> <span class="token punctuation">;</span><span class="token keyword">fi</span><span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span><span class="token string">"start"</span><span class="token punctuation">)</span>        <span class="token builtin class-name">echo</span> <span class="token string">" =================== 启动 hadoop集群 ==================="</span>        <span class="token builtin class-name">echo</span> <span class="token string">" --------------- 启动 hdfs ---------------"</span>        <span class="token function">ssh</span> hadoop101 <span class="token string">"start-dfs.sh"</span>        <span class="token builtin class-name">echo</span> <span class="token string">" --------------- 启动 yarn ---------------"</span>        <span class="token function">ssh</span> hadoop102 <span class="token string">"start-yarn.sh"</span>        <span class="token builtin class-name">echo</span> <span class="token string">" --------------- 启动 historyserver ---------------"</span>        <span class="token function">ssh</span> hadoop101 <span class="token string">"mapred --daemon start historyserver"</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token string">"stop"</span><span class="token punctuation">)</span>        <span class="token builtin class-name">echo</span> <span class="token string">" =================== 关闭 hadoop集群 ==================="</span>        <span class="token builtin class-name">echo</span> <span class="token string">" --------------- 关闭 historyserver ---------------"</span>        <span class="token function">ssh</span> hadoop101 <span class="token string">"mapred --daemon stop historyserver"</span>        <span class="token builtin class-name">echo</span> <span class="token string">" --------------- 关闭 yarn ---------------"</span>        <span class="token function">ssh</span> hadoop102 <span class="token string">"stop-yarn.sh"</span>        <span class="token builtin class-name">echo</span> <span class="token string">" --------------- 关闭 hdfs ---------------"</span>        <span class="token function">ssh</span> hadoop101 <span class="token string">"stop-dfs.sh"</span><span class="token punctuation">;</span><span class="token punctuation">;</span>*<span class="token punctuation">)</span>    <span class="token builtin class-name">echo</span> <span class="token string">"Input Args Error..."</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">esac</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="kfk"><a href="#kfk" class="headerlink" title="kfk"></a>kfk</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token shebang important">#!/bin/bash</span><span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span><span class="token string">"start"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop101 hadoop102 hadoop103    <span class="token keyword">do</span>        <span class="token builtin class-name">echo</span> <span class="token string">"================starting <span class="token variable">$i</span> kafka==========="</span>        <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">"kafka-server-start.sh -daemon <span class="token variable">$KAFKA_HOME</span>/config/server.properties"</span>    <span class="token keyword">done</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token string">"stop"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop101 hadoop102 hadoop103    <span class="token keyword">do</span>        <span class="token builtin class-name">echo</span> <span class="token string">"=============stoping <span class="token variable">$i</span> kafka==========="</span>        <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">"kafka-server-stop.sh stop"</span>    <span class="token keyword">done</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">esac</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="f1"><a href="#f1" class="headerlink" title="f1"></a>f1</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token shebang important">#! /bin/bash</span><span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span><span class="token string">"start"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop101 hadoop102        <span class="token keyword">do</span>                <span class="token builtin class-name">echo</span> <span class="token string">" --------启动 <span class="token variable">$i</span> 采集flume-------"</span>                <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">"nohup flume-ng agent --conf-file <span class="token variable">$FLUME_HOME</span>/conf/file-flume-kafka.conf --name a1 -Dflume.root.logger=INFO,LOGFILE >/opt/module/EBDW/flume/log1.txt 2>&amp;1  &amp;"</span>        <span class="token keyword">done</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"stop"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop101 hadoop102        <span class="token keyword">do</span>                <span class="token builtin class-name">echo</span> <span class="token string">" --------停止 <span class="token variable">$i</span> 采集flume-------"</span>                <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">"ps -ef | grep file-flume-kafka | grep -v grep |awk  '&#123;print \<span class="token variable">$2</span>&#125;' | xargs -n1 kill -9 "</span>        <span class="token keyword">done</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">esac</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="f2"><a href="#f2" class="headerlink" title="f2"></a>f2</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment">#消费flume集群操作脚本</span><span class="token comment">#! /bin/bash</span><span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span><span class="token string">"start"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop103        <span class="token keyword">do</span>                <span class="token builtin class-name">echo</span> <span class="token string">" --------启动 <span class="token variable">$i</span> 消费flume-------"</span>                <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">"nohup flume-ng agent --conf-file <span class="token variable">$FLUME_HOME</span>/conf/kafka-flume-hdfs.conf --name a1 -Dflume.root.logger=INFO,LOGFILE > <span class="token variable">$FLUME_HOME</span>/log2.txt   2>&amp;1 &amp;"</span>        <span class="token keyword">done</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token string">"stop"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop103        <span class="token keyword">do</span>                <span class="token builtin class-name">echo</span> <span class="token string">" --------停止 <span class="token variable">$i</span> 消费flume-------"</span>                <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">"ps -ef | grep kafka-flume-hdfs | grep -v grep |awk '&#123;print \<span class="token variable">$2</span>&#125;' | xargs -n1 kill"</span>        <span class="token keyword">done</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">esac</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="将业务数据从mysql传递到hdfs上"><a href="#将业务数据从mysql传递到hdfs上" class="headerlink" title="将业务数据从mysql传递到hdfs上"></a>将业务数据从mysql传递到hdfs上</h2><h3 id="mysql-to-hdfs-init-首日同步脚本"><a href="#mysql-to-hdfs-init-首日同步脚本" class="headerlink" title="mysql_to_hdfs_init(首日同步脚本)"></a>mysql_to_hdfs_init(首日同步脚本)</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token shebang important">#! /bin/bash</span><span class="token assign-left variable">APP</span><span class="token operator">=</span>gmall<span class="token comment"># sqoop=/opt/module/sqoop/bin/sqoop</span><span class="token keyword">if</span> <span class="token punctuation">[</span> -n <span class="token string">"<span class="token variable">$2</span>"</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span><span class="token keyword">then</span>   <span class="token assign-left variable">do_date</span><span class="token operator">=</span><span class="token variable">$2</span><span class="token keyword">else</span>    <span class="token builtin class-name">echo</span> <span class="token string">"请传入日期参数"</span>   <span class="token builtin class-name">exit</span><span class="token keyword">fi</span> <span class="token function-name function">import_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>sqoop <span class="token function">import</span> <span class="token punctuation">\</span>--connect jdbc:mysql://hadoop101:3306/<span class="token variable">$APP</span> <span class="token punctuation">\</span>--username root <span class="token punctuation">\</span>--password <span class="token number">764991</span> <span class="token punctuation">\</span>--target-dir /origin_data/<span class="token variable">$APP</span>/db/<span class="token variable">$1</span>/<span class="token variable">$do_date</span> <span class="token punctuation">\</span>--delete-target-dir <span class="token punctuation">\</span>--query <span class="token string">"<span class="token variable">$2</span> where \<span class="token variable">$CONDITIONS</span>"</span> <span class="token punctuation">\</span>--num-mappers <span class="token number">1</span> <span class="token punctuation">\</span>--fields-terminated-by <span class="token string">'\t'</span> <span class="token punctuation">\</span>--compress <span class="token punctuation">\</span>--compression-codec lzop <span class="token punctuation">\</span>--null-string <span class="token string">'\\N'</span> <span class="token punctuation">\</span>--null-non-string <span class="token string">'\\N'</span>hadoop jar /opt/module/EBDW/hadoop-3.1.3/share/hadoop/common/hadoop-lzo-0.4.20.jar com.hadoop.compression.lzo.DistributedLzoIndexer /origin_data/<span class="token variable">$APP</span>/db/<span class="token variable">$1</span>/<span class="token variable">$do_date</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_order_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  import_data order_info <span class="token string">"select                            id,                             total_amount,                             order_status,                             user_id,                             payment_way,                            delivery_address,                            out_trade_no,                             create_time,                             operate_time,                            expire_time,                            tracking_no,                            province_id,                            activity_reduce_amount,                            coupon_reduce_amount,                                                        original_total_amount,                            feight_fee,                            feight_fee_reduce                              from order_info"</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_coupon_use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  import_data coupon_use <span class="token string">"select                          id,                          coupon_id,                          user_id,                          order_id,                          coupon_status,                          get_time,                          using_time,                          used_time,                          expire_time                        from coupon_use"</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_order_status_log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  import_data order_status_log <span class="token string">"select                                  id,                                  order_id,                                  order_status,                                  operate_time                                from order_status_log"</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_user_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  import_data <span class="token string">"user_info"</span> <span class="token string">"select                             id,                            login_name,                            nick_name,                            name,                            phone_num,                            email,                            user_level,                             birthday,                            gender,                            create_time,                            operate_time                          from user_info"</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_order_detail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  import_data order_detail <span class="token string">"select                               id,                              order_id,                               sku_id,                              sku_name,                              order_price,                              sku_num,                               create_time,                              source_type,                              source_id,                              split_total_amount,                              split_activity_amount,                              split_coupon_amount                            from order_detail"</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_payment_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  import_data <span class="token string">"payment_info"</span>  <span class="token string">"select                                 id,                                  out_trade_no,                                 order_id,                                 user_id,                                 payment_type,                                 trade_no,                                 total_amount,                                  subject,                                 payment_status,                                create_time,                                callback_time                               from payment_info"</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_comment_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  import_data comment_info <span class="token string">"select                              id,                              user_id,                              sku_id,                              spu_id,                              order_id,                              appraise,                              create_time                            from comment_info"</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_order_refund_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  import_data order_refund_info <span class="token string">"select                                id,                                user_id,                                order_id,                                sku_id,                                refund_type,                                refund_num,                                refund_amount,                                refund_reason_type,                                refund_status,                                create_time                              from order_refund_info"</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_sku_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  import_data sku_info <span class="token string">"select                           id,                          spu_id,                          price,                          sku_name,                          sku_desc,                          weight,                          tm_id,                          category3_id,                          is_sale,                          create_time                        from sku_info"</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_base_category1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  import_data <span class="token string">"base_category1"</span> <span class="token string">"select                                   id,                                  name                                 from base_category1"</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_base_category2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  import_data <span class="token string">"base_category2"</span> <span class="token string">"select                                  id,                                  name,                                  category1_id                                 from base_category2"</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_base_category3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  import_data <span class="token string">"base_category3"</span> <span class="token string">"select                                  id,                                  name,                                  category2_id                                from base_category3"</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_base_province</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  import_data base_province <span class="token string">"select                              id,                              name,                              region_id,                              area_code,                              iso_code,                              iso_3166_2                            from base_province"</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_base_region</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  import_data base_region <span class="token string">"select                              id,                              region_name                            from base_region"</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_base_trademark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  import_data base_trademark <span class="token string">"select                                id,                                tm_name                              from base_trademark"</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_spu_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  import_data spu_info <span class="token string">"select                            id,                            spu_name,                            category3_id,                            tm_id                          from spu_info"</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_favor_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  import_data favor_info <span class="token string">"select                          id,                          user_id,                          sku_id,                          spu_id,                          is_cancel,                          create_time,                          cancel_time                        from favor_info"</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_cart_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  import_data cart_info <span class="token string">"select                        id,                        user_id,                        sku_id,                        cart_price,                        sku_num,                        sku_name,                        create_time,                        operate_time,                        is_ordered,                        order_time,                        source_type,                        source_id                      from cart_info"</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_coupon_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  import_data coupon_info <span class="token string">"select                          id,                          coupon_name,                          coupon_type,                          condition_amount,                          condition_num,                          activity_id,                          benefit_amount,                          benefit_discount,                          create_time,                          range_type,                          limit_num,                          taken_count,                          start_time,                          end_time,                          operate_time,                          expire_time                        from coupon_info"</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_activity_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  import_data activity_info <span class="token string">"select                              id,                              activity_name,                              activity_type,                              start_time,                              end_time,                              create_time                            from activity_info"</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_activity_rule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    import_data activity_rule <span class="token string">"select                                    id,                                    activity_id,                                    activity_type,                                    condition_amount,                                    condition_num,                                    benefit_amount,                                    benefit_discount,                                    benefit_level                                from activity_rule"</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_base_dic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    import_data base_dic <span class="token string">"select                            dic_code,                            dic_name,                            parent_code,                            create_time,                            operate_time                          from base_dic"</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_order_detail_activity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    import_data order_detail_activity <span class="token string">"select                                                                id,                                                                order_id,                                                                order_detail_id,                                                                activity_id,                                                                activity_rule_id,                                                                sku_id,                                                                create_time                                                            from order_detail_activity"</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_order_detail_coupon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    import_data order_detail_coupon <span class="token string">"select                                                                id,                                                                                order_id,                                                                order_detail_id,                                                                coupon_id,                                                                coupon_use_id,                                                                sku_id,                                                                create_time                                                            from order_detail_coupon"</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_refund_payment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    import_data refund_payment <span class="token string">"select                                                        id,                                                        out_trade_no,                                                        order_id,                                                        sku_id,                                                        payment_type,                                                        trade_no,                                                        total_amount,                                                        subject,                                                        refund_status,                                                        create_time,                                                        callback_time                                                    from refund_payment"</span>                                                    <span class="token punctuation">&#125;</span><span class="token function-name function">import_sku_attr_value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    import_data sku_attr_value <span class="token string">"select                                                    id,                                                    attr_id,                                                    value_id,                                                    sku_id,                                                    attr_name,                                                    value_name                                                from sku_attr_value"</span><span class="token punctuation">&#125;</span><span class="token function-name function">import_sku_sale_attr_value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    import_data sku_sale_attr_value <span class="token string">"select                                                            id,                                                            sku_id,                                                            spu_id,                                                            sale_attr_value_id,                                                            sale_attr_id,                                                            sale_attr_name,                                                            sale_attr_value_name                                                        from sku_sale_attr_value"</span><span class="token punctuation">&#125;</span><span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span>  <span class="token string">"order_info"</span><span class="token punctuation">)</span>     import_order_info<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"base_category1"</span><span class="token punctuation">)</span>     import_base_category1<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"base_category2"</span><span class="token punctuation">)</span>     import_base_category2<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"base_category3"</span><span class="token punctuation">)</span>     import_base_category3<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"order_detail"</span><span class="token punctuation">)</span>     import_order_detail<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"sku_info"</span><span class="token punctuation">)</span>     import_sku_info<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"user_info"</span><span class="token punctuation">)</span>     import_user_info<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"payment_info"</span><span class="token punctuation">)</span>     import_payment_info<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"base_province"</span><span class="token punctuation">)</span>     import_base_province<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"base_region"</span><span class="token punctuation">)</span>     import_base_region<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"base_trademark"</span><span class="token punctuation">)</span>     import_base_trademark<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"activity_info"</span><span class="token punctuation">)</span>      import_activity_info<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"cart_info"</span><span class="token punctuation">)</span>      import_cart_info<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"comment_info"</span><span class="token punctuation">)</span>      import_comment_info<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"coupon_info"</span><span class="token punctuation">)</span>      import_coupon_info<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"coupon_use"</span><span class="token punctuation">)</span>      import_coupon_use<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"favor_info"</span><span class="token punctuation">)</span>      import_favor_info<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"order_refund_info"</span><span class="token punctuation">)</span>      import_order_refund_info<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"order_status_log"</span><span class="token punctuation">)</span>      import_order_status_log<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"spu_info"</span><span class="token punctuation">)</span>      import_spu_info<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"activity_rule"</span><span class="token punctuation">)</span>      import_activity_rule<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"base_dic"</span><span class="token punctuation">)</span>      import_base_dic<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"order_detail_activity"</span><span class="token punctuation">)</span>      import_order_detail_activity<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"order_detail_coupon"</span><span class="token punctuation">)</span>      import_order_detail_coupon<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"refund_payment"</span><span class="token punctuation">)</span>      import_refund_payment<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"sku_attr_value"</span><span class="token punctuation">)</span>      import_sku_attr_value<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"sku_sale_attr_value"</span><span class="token punctuation">)</span>      import_sku_sale_attr_value<span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token string">"all"</span><span class="token punctuation">)</span>   import_base_category1   import_base_category2   import_base_category3   import_order_info   import_order_detail   import_sku_info   import_user_info   import_payment_info   import_base_region   import_base_province   import_base_trademark   import_activity_info   import_cart_info   import_comment_info   import_coupon_use   import_coupon_info   import_favor_info   import_order_refund_info   import_order_status_log   import_spu_info   import_activity_rule   import_base_dic   import_order_detail_activity   import_order_detail_coupon   import_refund_payment   import_sku_attr_value   import_sku_sale_attr_value<span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">esac</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="mysql-to-hdfs-每日同步脚本"><a href="#mysql-to-hdfs-每日同步脚本" class="headerlink" title="mysql_to_hdfs(每日同步脚本)"></a>mysql_to_hdfs(每日同步脚本)</h3><pre class="line-numbers language-none"><code class="language-none">#! &#x2F;bin&#x2F;bashAPP&#x3D;gmall#sqoop&#x3D;&#x2F;opt&#x2F;module&#x2F;sqoop&#x2F;bin&#x2F;sqoopif [ -n &quot;$2&quot; ] ;then    do_date&#x3D;$2else    do_date&#x3D;&#96;date -d &#39;-1 day&#39; +%F&#96;fiimport_data()&#123;sqoop import \--connect jdbc:mysql:&#x2F;&#x2F;hadoop101:3306&#x2F;$APP \--username root \--password 764991 \--target-dir &#x2F;origin_data&#x2F;$APP&#x2F;db&#x2F;$1&#x2F;$do_date \--delete-target-dir \--query &quot;$2 and  \$CONDITIONS&quot; \--num-mappers 1 \--fields-terminated-by &#39;\t&#39; \--compress \--compression-codec lzop \--null-string &#39;\\N&#39; \--null-non-string &#39;\\N&#39;hadoop jar &#x2F;opt&#x2F;module&#x2F;EBDW&#x2F;hadoop-3.1.3&#x2F;share&#x2F;hadoop&#x2F;common&#x2F;hadoop-lzo-0.4.20.jar com.hadoop.compression.lzo.DistributedLzoIndexer &#x2F;origin_data&#x2F;$APP&#x2F;db&#x2F;$1&#x2F;$do_date&#125;import_order_info()&#123;  import_data order_info &quot;select                            id,                             total_amount,                             order_status,                             user_id,                             payment_way,                            delivery_address,                            out_trade_no,                             create_time,                             operate_time,                            expire_time,                            tracking_no,                            province_id,                            activity_reduce_amount,                            coupon_reduce_amount,                                                        original_total_amount,                            feight_fee,                            feight_fee_reduce                              from order_info                        where (date_format(create_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$do_date&#39;                         or date_format(operate_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$do_date&#39;)&quot;&#125;import_coupon_use()&#123;  import_data coupon_use &quot;select                          id,                          coupon_id,                          user_id,                          order_id,                          coupon_status,                          get_time,                          using_time,                          used_time,                          expire_time                        from coupon_use                        where (date_format(get_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$do_date&#39;                        or date_format(using_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$do_date&#39;                        or date_format(used_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$do_date&#39;                        or date_format(expire_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$do_date&#39;)&quot;&#125;import_order_status_log()&#123;  import_data order_status_log &quot;select                                  id,                                  order_id,                                  order_status,                                  operate_time                                from order_status_log                                where date_format(operate_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$do_date&#39;&quot;&#125;import_user_info()&#123;  import_data &quot;user_info&quot; &quot;select                             id,                            login_name,                            nick_name,                            name,                            phone_num,                            email,                            user_level,                             birthday,                            gender,                            create_time,                            operate_time                          from user_info                           where (DATE_FORMAT(create_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$do_date&#39;                           or DATE_FORMAT(operate_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$do_date&#39;)&quot;&#125;import_order_detail()&#123;  import_data order_detail &quot;select                               id,                              order_id,                               sku_id,                              sku_name,                              order_price,                              sku_num,                               create_time,                              source_type,                              source_id,                              split_total_amount,                              split_activity_amount,                              split_coupon_amount                            from order_detail                             where DATE_FORMAT(create_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$do_date&#39;&quot;&#125;import_payment_info()&#123;  import_data &quot;payment_info&quot;  &quot;select                                 id,                                  out_trade_no,                                 order_id,                                 user_id,                                 payment_type,                                 trade_no,                                 total_amount,                                  subject,                                 payment_status,                                create_time,                                callback_time                               from payment_info                               where (DATE_FORMAT(create_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$do_date&#39;                               or DATE_FORMAT(callback_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$do_date&#39;)&quot;&#125;import_comment_info()&#123;  import_data comment_info &quot;select                              id,                              user_id,                              sku_id,                              spu_id,                              order_id,                              appraise,                              create_time                            from comment_info                            where date_format(create_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$do_date&#39;&quot;&#125;import_order_refund_info()&#123;  import_data order_refund_info &quot;select                                id,                                user_id,                                order_id,                                sku_id,                                refund_type,                                refund_num,                                refund_amount,                                refund_reason_type,                                refund_status,                                create_time                              from order_refund_info                              where date_format(create_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$do_date&#39;&quot;&#125;import_sku_info()&#123;  import_data sku_info &quot;select                           id,                          spu_id,                          price,                          sku_name,                          sku_desc,                          weight,                          tm_id,                          category3_id,                          is_sale,                          create_time                        from sku_info where 1&#x3D;1&quot;&#125;import_base_category1()&#123;  import_data &quot;base_category1&quot; &quot;select                                   id,                                  name                                 from base_category1 where 1&#x3D;1&quot;&#125;import_base_category2()&#123;  import_data &quot;base_category2&quot; &quot;select                                  id,                                  name,                                  category1_id                                 from base_category2 where 1&#x3D;1&quot;&#125;import_base_category3()&#123;  import_data &quot;base_category3&quot; &quot;select                                  id,                                  name,                                  category2_id                                from base_category3 where 1&#x3D;1&quot;&#125;import_base_province()&#123;  import_data base_province &quot;select                              id,                              name,                              region_id,                              area_code,                              iso_code,                              iso_3166_2                            from base_province                            where 1&#x3D;1&quot;&#125;import_base_region()&#123;  import_data base_region &quot;select                              id,                              region_name                            from base_region                            where 1&#x3D;1&quot;&#125;import_base_trademark()&#123;  import_data base_trademark &quot;select                                id,                                tm_name                              from base_trademark                              where 1&#x3D;1&quot;&#125;import_spu_info()&#123;  import_data spu_info &quot;select                            id,                            spu_name,                            category3_id,                            tm_id                          from spu_info                          where 1&#x3D;1&quot;&#125;import_favor_info()&#123;  import_data favor_info &quot;select                          id,                          user_id,                          sku_id,                          spu_id,                          is_cancel,                          create_time,                          cancel_time                        from favor_info                        where 1&#x3D;1&quot;&#125;import_cart_info()&#123;  import_data cart_info &quot;select                        id,                        user_id,                        sku_id,                        cart_price,                        sku_num,                        sku_name,                        create_time,                        operate_time,                        is_ordered,                        order_time,                        source_type,                        source_id                      from cart_info                      where 1&#x3D;1&quot;&#125;import_coupon_info()&#123;  import_data coupon_info &quot;select                          id,                          coupon_name,                          coupon_type,                          condition_amount,                          condition_num,                          activity_id,                          benefit_amount,                          benefit_discount,                          create_time,                          range_type,                          limit_num,                          taken_count,                          start_time,                          end_time,                          operate_time,                          expire_time                        from coupon_info                        where 1&#x3D;1&quot;&#125;import_activity_info()&#123;  import_data activity_info &quot;select                              id,                              activity_name,                              activity_type,                              start_time,                              end_time,                              create_time                            from activity_info                            where 1&#x3D;1&quot;&#125;import_activity_rule()&#123;    import_data activity_rule &quot;select                                    id,                                    activity_id,                                    activity_type,                                    condition_amount,                                    condition_num,                                    benefit_amount,                                    benefit_discount,                                    benefit_level                                from activity_rule                                where 1&#x3D;1&quot;&#125;import_base_dic()&#123;    import_data base_dic &quot;select                            dic_code,                            dic_name,                            parent_code,                            create_time,                            operate_time                          from base_dic                          where 1&#x3D;1&quot;&#125;import_order_detail_activity()&#123;    import_data order_detail_activity &quot;select                                                                id,                                                                order_id,                                                                order_detail_id,                                                                activity_id,                                                                activity_rule_id,                                                                sku_id,                                                                create_time                                                            from order_detail_activity                                                            where date_format(create_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$do_date&#39;&quot;&#125;import_order_detail_coupon()&#123;    import_data order_detail_coupon &quot;select                                                                id,                                                                                order_id,                                                                order_detail_id,                                                                coupon_id,                                                                coupon_use_id,                                                                sku_id,                                                                create_time                                                            from order_detail_coupon                                                            where date_format(create_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$do_date&#39;&quot;&#125;import_refund_payment()&#123;    import_data refund_payment &quot;select                                                        id,                                                        out_trade_no,                                                        order_id,                                                        sku_id,                                                        payment_type,                                                        trade_no,                                                        total_amount,                                                        subject,                                                        refund_status,                                                        create_time,                                                        callback_time                                                    from refund_payment                                                    where (DATE_FORMAT(create_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$do_date&#39;                                                     or DATE_FORMAT(callback_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$do_date&#39;)&quot;                                                    &#125;import_sku_attr_value()&#123;    import_data sku_attr_value &quot;select                                                    id,                                                    attr_id,                                                    value_id,                                                    sku_id,                                                    attr_name,                                                    value_name                                                from sku_attr_value                                                where 1&#x3D;1&quot;&#125;import_sku_sale_attr_value()&#123;    import_data sku_sale_attr_value &quot;select                                                            id,                                                            sku_id,                                                            spu_id,                                                            sale_attr_value_id,                                                            sale_attr_id,                                                            sale_attr_name,                                                            sale_attr_value_name                                                        from sku_sale_attr_value                                                        where 1&#x3D;1&quot;&#125;case $1 in  &quot;order_info&quot;)     import_order_info;;  &quot;base_category1&quot;)     import_base_category1;;  &quot;base_category2&quot;)     import_base_category2;;  &quot;base_category3&quot;)     import_base_category3;;  &quot;order_detail&quot;)     import_order_detail;;  &quot;sku_info&quot;)     import_sku_info;;  &quot;user_info&quot;)     import_user_info;;  &quot;payment_info&quot;)     import_payment_info;;  &quot;base_province&quot;)     import_base_province;;  &quot;activity_info&quot;)      import_activity_info;;  &quot;cart_info&quot;)      import_cart_info;;  &quot;comment_info&quot;)      import_comment_info;;  &quot;coupon_info&quot;)      import_coupon_info;;  &quot;coupon_use&quot;)      import_coupon_use;;  &quot;favor_info&quot;)      import_favor_info;;  &quot;order_refund_info&quot;)      import_order_refund_info;;  &quot;order_status_log&quot;)      import_order_status_log;;  &quot;spu_info&quot;)      import_spu_info;;  &quot;activity_rule&quot;)      import_activity_rule;;  &quot;base_dic&quot;)      import_base_dic;;  &quot;order_detail_activity&quot;)      import_order_detail_activity;;  &quot;order_detail_coupon&quot;)      import_order_detail_coupon;;  &quot;refund_payment&quot;)      import_refund_payment;;  &quot;sku_attr_value&quot;)      import_sku_attr_value;;  &quot;sku_sale_attr_value&quot;)      import_sku_sale_attr_value;;&quot;all&quot;)   import_base_category1   import_base_category2   import_base_category3   import_order_info   import_order_detail   import_sku_info   import_user_info   import_payment_info   import_base_trademark   import_activity_info   import_cart_info   import_comment_info   import_coupon_use   import_coupon_info   import_favor_info   import_order_refund_info   import_order_status_log   import_spu_info   import_activity_rule   import_base_dic   import_order_detail_activity   import_order_detail_coupon   import_refund_payment   import_sku_attr_value   import_sku_sale_attr_value;;esac<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="将数据从hdfs转入ods层"><a href="#将数据从hdfs转入ods层" class="headerlink" title="将数据从hdfs转入ods层"></a>将数据从hdfs转入ods层</h2><h3 id="将业务数据从hdfs层转入ods层-首日同步脚本"><a href="#将业务数据从hdfs层转入ods层-首日同步脚本" class="headerlink" title="将业务数据从hdfs层转入ods层(首日同步脚本)"></a>将业务数据从hdfs层转入ods层(首日同步脚本)</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">APP</span><span class="token operator">=</span>gmall<span class="token keyword">if</span> <span class="token punctuation">[</span> -n <span class="token string">"<span class="token variable">$2</span>"</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span><span class="token keyword">then</span>   <span class="token assign-left variable">do_date</span><span class="token operator">=</span><span class="token variable">$2</span><span class="token keyword">else</span>    <span class="token builtin class-name">echo</span> <span class="token string">"请传入日期参数"</span>   <span class="token builtin class-name">exit</span><span class="token keyword">fi</span> <span class="token assign-left variable">ods_order_info</span><span class="token operator">=</span><span class="token string">" load data inpath '/origin_data/<span class="token variable">$APP</span>/db/order_info/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_order_info partition(dt='<span class="token variable">$do_date</span>');"</span><span class="token assign-left variable">ods_order_detail</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/order_detail/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_order_detail partition(dt='<span class="token variable">$do_date</span>');"</span><span class="token assign-left variable">ods_sku_info</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/sku_info/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_sku_info partition(dt='<span class="token variable">$do_date</span>');"</span><span class="token assign-left variable">ods_user_info</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/user_info/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_user_info partition(dt='<span class="token variable">$do_date</span>');"</span><span class="token assign-left variable">ods_payment_info</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/payment_info/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_payment_info partition(dt='<span class="token variable">$do_date</span>');"</span><span class="token assign-left variable">ods_base_category1</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/base_category1/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_base_category1 partition(dt='<span class="token variable">$do_date</span>');"</span><span class="token assign-left variable">ods_base_category2</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/base_category2/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_base_category2 partition(dt='<span class="token variable">$do_date</span>');"</span><span class="token assign-left variable">ods_base_category3</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/base_category3/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_base_category3 partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_base_trademark</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/base_trademark/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_base_trademark partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_activity_info</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/activity_info/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_activity_info partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_cart_info</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/cart_info/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_cart_info partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_comment_info</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/comment_info/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_comment_info partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_coupon_info</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/coupon_info/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_coupon_info partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_coupon_use</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/coupon_use/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_coupon_use partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_favor_info</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/favor_info/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_favor_info partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_order_refund_info</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/order_refund_info/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_order_refund_info partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_order_status_log</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/order_status_log/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_order_status_log partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_spu_info</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/spu_info/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_spu_info partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_activity_rule</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/activity_rule/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_activity_rule partition(dt='<span class="token variable">$do_date</span>');"</span> <span class="token assign-left variable">ods_base_dic</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/base_dic/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_base_dic partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_order_detail_activity</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/order_detail_activity/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_order_detail_activity partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_order_detail_coupon</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/order_detail_coupon/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_order_detail_coupon partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_refund_payment</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/refund_payment/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_refund_payment partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_sku_attr_value</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/sku_attr_value/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_sku_attr_value partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_sku_sale_attr_value</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/sku_sale_attr_value/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_sku_sale_attr_value partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_base_province</span><span class="token operator">=</span><span class="token string">" load data inpath '/origin_data/<span class="token variable">$APP</span>/db/base_province/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_base_province;"</span><span class="token assign-left variable">ods_base_region</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/base_region/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_base_region;"</span><span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span>    <span class="token string">"ods_order_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_order_info</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_order_detail"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_order_detail</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_sku_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_sku_info</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_user_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_user_info</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_payment_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_payment_info</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_base_category1"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_base_category1</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_base_category2"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_base_category2</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_base_category3"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_base_category3</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_base_trademark"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_base_trademark</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_activity_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_activity_info</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_cart_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_cart_info</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_comment_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_comment_info</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_coupon_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_coupon_info</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_coupon_use"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_coupon_use</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_favor_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_favor_info</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_order_refund_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_order_refund_info</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_order_status_log"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_order_status_log</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_spu_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_spu_info</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_activity_rule"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_activity_rule</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_base_dic"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_base_dic</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_order_detail_activity"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_order_detail_activity</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_order_detail_coupon"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_order_detail_coupon</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_refund_payment"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_refund_payment</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_sku_attr_value"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_sku_attr_value</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_sku_sale_attr_value"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_sku_sale_attr_value</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_base_province"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_base_province</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_base_region"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_base_region</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"all"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_order_info</span><span class="token variable">$ods_order_detail</span><span class="token variable">$ods_sku_info</span><span class="token variable">$ods_user_info</span><span class="token variable">$ods_payment_info</span><span class="token variable">$ods_base_category1</span><span class="token variable">$ods_base_category2</span><span class="token variable">$ods_base_category3</span><span class="token variable">$ods_base_trademark</span><span class="token variable">$ods_activity_info</span><span class="token variable">$ods_cart_info</span><span class="token variable">$ods_comment_info</span><span class="token variable">$ods_coupon_info</span><span class="token variable">$ods_coupon_use</span><span class="token variable">$ods_favor_info</span><span class="token variable">$ods_order_refund_info</span><span class="token variable">$ods_order_status_log</span><span class="token variable">$ods_spu_info</span><span class="token variable">$ods_activity_rule</span><span class="token variable">$ods_base_dic</span><span class="token variable">$ods_order_detail_activity</span><span class="token variable">$ods_order_detail_coupon</span><span class="token variable">$ods_refund_payment</span><span class="token variable">$ods_sku_attr_value</span><span class="token variable">$ods_sku_sale_attr_value</span><span class="token variable">$ods_base_province</span><span class="token variable">$ods_base_region</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">esac</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="将业务数据从hdfs转入ods层-每日同步脚本"><a href="#将业务数据从hdfs转入ods层-每日同步脚本" class="headerlink" title="将业务数据从hdfs转入ods层(每日同步脚本)"></a>将业务数据从hdfs转入ods层(每日同步脚本)</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">APP</span><span class="token operator">=</span>gmall<span class="token comment"># 如果是输入的日期按照取输入日期；如果没输入日期取当前时间的前一天</span><span class="token keyword">if</span> <span class="token punctuation">[</span> -n <span class="token string">"<span class="token variable">$2</span>"</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span><span class="token keyword">then</span>    <span class="token assign-left variable">do_date</span><span class="token operator">=</span><span class="token variable">$2</span><span class="token keyword">else</span>     <span class="token assign-left variable">do_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-1 day"</span> +%F<span class="token variable">`</span></span><span class="token keyword">fi</span><span class="token assign-left variable">ods_order_info</span><span class="token operator">=</span><span class="token string">" load data inpath '/origin_data/<span class="token variable">$APP</span>/db/order_info/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_order_info partition(dt='<span class="token variable">$do_date</span>');"</span><span class="token assign-left variable">ods_order_detail</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/order_detail/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_order_detail partition(dt='<span class="token variable">$do_date</span>');"</span><span class="token assign-left variable">ods_sku_info</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/sku_info/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_sku_info partition(dt='<span class="token variable">$do_date</span>');"</span><span class="token assign-left variable">ods_user_info</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/user_info/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_user_info partition(dt='<span class="token variable">$do_date</span>');"</span><span class="token assign-left variable">ods_payment_info</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/payment_info/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_payment_info partition(dt='<span class="token variable">$do_date</span>');"</span><span class="token assign-left variable">ods_base_category1</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/base_category1/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_base_category1 partition(dt='<span class="token variable">$do_date</span>');"</span><span class="token assign-left variable">ods_base_category2</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/base_category2/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_base_category2 partition(dt='<span class="token variable">$do_date</span>');"</span><span class="token assign-left variable">ods_base_category3</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/base_category3/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_base_category3 partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_base_trademark</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/base_trademark/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_base_trademark partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_activity_info</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/activity_info/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_activity_info partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_cart_info</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/cart_info/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_cart_info partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_comment_info</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/comment_info/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_comment_info partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_coupon_info</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/coupon_info/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_coupon_info partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_coupon_use</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/coupon_use/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_coupon_use partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_favor_info</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/favor_info/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_favor_info partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_order_refund_info</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/order_refund_info/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_order_refund_info partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_order_status_log</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/order_status_log/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_order_status_log partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_spu_info</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/spu_info/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_spu_info partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_activity_rule</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/activity_rule/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_activity_rule partition(dt='<span class="token variable">$do_date</span>');"</span> <span class="token assign-left variable">ods_base_dic</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/base_dic/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_base_dic partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_order_detail_activity</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/order_detail_activity/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_order_detail_activity partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_order_detail_coupon</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/order_detail_coupon/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_order_detail_coupon partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_refund_payment</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/refund_payment/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_refund_payment partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_sku_attr_value</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/sku_attr_value/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_sku_attr_value partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_sku_sale_attr_value</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/sku_sale_attr_value/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_sku_sale_attr_value partition(dt='<span class="token variable">$do_date</span>'); "</span><span class="token assign-left variable">ods_base_province</span><span class="token operator">=</span><span class="token string">" load data inpath '/origin_data/<span class="token variable">$APP</span>/db/base_province/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_base_province;"</span><span class="token assign-left variable">ods_base_region</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/db/base_region/<span class="token variable">$do_date</span>' OVERWRITE into table <span class="token variable">$&#123;APP&#125;</span>.ods_base_region;"</span><span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span>    <span class="token string">"ods_order_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_order_info</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_order_detail"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_order_detail</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_sku_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_sku_info</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_user_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_user_info</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_payment_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_payment_info</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_base_category1"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_base_category1</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_base_category2"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_base_category2</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_base_category3"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_base_category3</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_base_trademark"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_base_trademark</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_activity_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_activity_info</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_cart_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_cart_info</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_comment_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_comment_info</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_coupon_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_coupon_info</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_coupon_use"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_coupon_use</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_favor_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_favor_info</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_order_refund_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_order_refund_info</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_order_status_log"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_order_status_log</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_spu_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_spu_info</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_activity_rule"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_activity_rule</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_base_dic"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_base_dic</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_order_detail_activity"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_order_detail_activity</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_order_detail_coupon"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_order_detail_coupon</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_refund_payment"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_refund_payment</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_sku_attr_value"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_sku_attr_value</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"ods_sku_sale_attr_value"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_sku_sale_attr_value</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token string">"all"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        hive -e <span class="token string">"<span class="token variable">$ods_order_info</span><span class="token variable">$ods_order_detail</span><span class="token variable">$ods_sku_info</span><span class="token variable">$ods_user_info</span><span class="token variable">$ods_payment_info</span><span class="token variable">$ods_base_category1</span><span class="token variable">$ods_base_category2</span><span class="token variable">$ods_base_category3</span><span class="token variable">$ods_base_trademark</span><span class="token variable">$ods_activity_info</span><span class="token variable">$ods_cart_info</span><span class="token variable">$ods_comment_info</span><span class="token variable">$ods_coupon_info</span><span class="token variable">$ods_coupon_use</span><span class="token variable">$ods_favor_info</span><span class="token variable">$ods_order_refund_info</span><span class="token variable">$ods_order_status_log</span><span class="token variable">$ods_spu_info</span><span class="token variable">$ods_activity_rule</span><span class="token variable">$ods_base_dic</span><span class="token variable">$ods_order_detail_activity</span><span class="token variable">$ods_order_detail_coupon</span><span class="token variable">$ods_refund_payment</span><span class="token variable">$ods_sku_attr_value</span><span class="token variable">$ods_sku_sale_attr_value</span>"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">esac</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="将用户行为数据从hdfs转入ods层"><a href="#将用户行为数据从hdfs转入ods层" class="headerlink" title="将用户行为数据从hdfs转入ods层"></a>将用户行为数据从hdfs转入ods层</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token shebang important">#!/bin/bash</span><span class="token comment"># 定义变量方便修改</span><span class="token assign-left variable">APP</span><span class="token operator">=</span>gmall<span class="token comment"># 如果是输入的日期按照取输入日期；如果没输入日期取当前时间的前一天</span><span class="token keyword">if</span> <span class="token punctuation">[</span> -n <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span><span class="token keyword">then</span>   <span class="token assign-left variable">do_date</span><span class="token operator">=</span><span class="token variable">$1</span><span class="token keyword">else</span>    <span class="token assign-left variable">do_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-1 day"</span> +%F<span class="token variable">`</span></span><span class="token keyword">fi</span> <span class="token builtin class-name">echo</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> 日志日期为 <span class="token variable">$do_date</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token assign-left variable">sql</span><span class="token operator">=</span><span class="token string">"load data inpath '/origin_data/<span class="token variable">$APP</span>/log/topic_log/<span class="token variable">$do_date</span>' into table <span class="token variable">$&#123;APP&#125;</span>.ods_log partition(dt='<span class="token variable">$do_date</span>');"</span>hive -e <span class="token string">"<span class="token variable">$sql</span>"</span>hadoop jar /opt/module/EBDW/hadoop-3.1.3/share/hadoop/common/hadoop-lzo-0.4.20.jar com.hadoop.compression.lzo.DistributedLzoIndexer /warehouse/<span class="token variable">$APP</span>/ods/ods_log/dt<span class="token operator">=</span><span class="token variable">$do_date</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="将dos层数据传入dim层"><a href="#将dos层数据传入dim层" class="headerlink" title="将dos层数据传入dim层"></a>将dos层数据传入dim层</h2><h3 id="ods-to-dim-db-init-首日同步脚本"><a href="#ods-to-dim-db-init-首日同步脚本" class="headerlink" title="ods_to_dim_db_init(首日同步脚本)"></a>ods_to_dim_db_init(首日同步脚本)</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">APP</span><span class="token operator">=</span>gmall<span class="token keyword">if</span> <span class="token punctuation">[</span> -n <span class="token string">"<span class="token variable">$2</span>"</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span><span class="token keyword">then</span>   <span class="token assign-left variable">do_date</span><span class="token operator">=</span><span class="token variable">$2</span><span class="token keyword">else</span>    <span class="token builtin class-name">echo</span> <span class="token string">"请传入日期参数"</span>   <span class="token builtin class-name">exit</span><span class="token keyword">fi</span> <span class="token assign-left variable">dim_user_info</span><span class="token operator">=</span><span class="token string">"set hive.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat;insert overwrite table <span class="token variable">$&#123;APP&#125;</span>.dim_user_info partition(dt='9999-99-99')select    id,    login_name,    nick_name,    md5(name),    md5(phone_num),    md5(email),    user_level,    birthday,    gender,    create_time,    operate_time,    '<span class="token variable">$do_date</span>',    '9999-99-99'from <span class="token variable">$&#123;APP&#125;</span>.ods_user_infowhere dt='<span class="token variable">$do_date</span>';"</span><span class="token assign-left variable">dim_sku_info</span><span class="token operator">=</span><span class="token string">"set hive.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat;withsku as(    select        id,        price,        sku_name,        sku_desc,        weight,        is_sale,        spu_id,        category3_id,        tm_id,        create_time    from <span class="token variable">$&#123;APP&#125;</span>.ods_sku_info    where dt='<span class="token variable">$do_date</span>'),spu as(    select        id,        spu_name    from <span class="token variable">$&#123;APP&#125;</span>.ods_spu_info    where dt='<span class="token variable">$do_date</span>'),c3 as(    select        id,        name,        category2_id    from <span class="token variable">$&#123;APP&#125;</span>.ods_base_category3    where dt='<span class="token variable">$do_date</span>'),c2 as(    select        id,        name,        category1_id    from <span class="token variable">$&#123;APP&#125;</span>.ods_base_category2    where dt='<span class="token variable">$do_date</span>'),c1 as(    select        id,        name    from <span class="token variable">$&#123;APP&#125;</span>.ods_base_category1    where dt='<span class="token variable">$do_date</span>'),tm as(    select        id,        tm_name    from <span class="token variable">$&#123;APP&#125;</span>.ods_base_trademark    where dt='<span class="token variable">$do_date</span>'),attr as(    select        sku_id,        collect_set(named_struct('attr_id',attr_id,'value_id',value_id,'attr_name',attr_name,'value_name',value_name)) attrs    from <span class="token variable">$&#123;APP&#125;</span>.ods_sku_attr_value    where dt='<span class="token variable">$do_date</span>'    group by sku_id),sale_attr as(    select        sku_id,        collect_set(named_struct('sale_attr_id',sale_attr_id,'sale_attr_value_id',sale_attr_value_id,'sale_attr_name',sale_attr_name,'sale_attr_value_name',sale_attr_value_name)) sale_attrs    from <span class="token variable">$&#123;APP&#125;</span>.ods_sku_sale_attr_value    where dt='<span class="token variable">$do_date</span>'    group by sku_id)insert overwrite table <span class="token variable">$&#123;APP&#125;</span>.dim_sku_info partition(dt='<span class="token variable">$do_date</span>')select    sku.id,    sku.price,    sku.sku_name,    sku.sku_desc,    sku.weight,    sku.is_sale,    sku.spu_id,    spu.spu_name,    sku.category3_id,    c3.name,    c3.category2_id,    c2.name,    c2.category1_id,    c1.name,    sku.tm_id,    tm.tm_name,    attr.attrs,    sale_attr.sale_attrs,    sku.create_timefrom skuleft join spu on sku.spu_id=spu.idleft join c3 on sku.category3_id=c3.idleft join c2 on c3.category2_id=c2.idleft join c1 on c2.category1_id=c1.idleft join tm on sku.tm_id=tm.idleft join attr on sku.id=attr.sku_idleft join sale_attr on sku.id=sale_attr.sku_id;"</span><span class="token assign-left variable">dim_base_province</span><span class="token operator">=</span><span class="token string">"set hive.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat;insert overwrite table <span class="token variable">$&#123;APP&#125;</span>.dim_base_provinceselect    bp.id,    bp.name,    bp.area_code,    bp.iso_code,    bp.iso_3166_2,    bp.region_id,    br.region_namefrom <span class="token variable">$&#123;APP&#125;</span>.ods_base_province bpjoin <span class="token variable">$&#123;APP&#125;</span>.ods_base_region br on bp.region_id = br.id;"</span><span class="token assign-left variable">dim_coupon_info</span><span class="token operator">=</span><span class="token string">"set hive.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat;insert overwrite table <span class="token variable">$&#123;APP&#125;</span>.dim_coupon_info partition(dt='<span class="token variable">$do_date</span>')select    id,    coupon_name,    coupon_type,    condition_amount,    condition_num,    activity_id,    benefit_amount,    benefit_discount,    create_time,    range_type,    limit_num,    taken_count,    start_time,    end_time,    operate_time,    expire_timefrom <span class="token variable">$&#123;APP&#125;</span>.ods_coupon_infowhere dt='<span class="token variable">$do_date</span>';"</span><span class="token assign-left variable">dim_activity_rule_info</span><span class="token operator">=</span><span class="token string">"set hive.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat;insert overwrite table <span class="token variable">$&#123;APP&#125;</span>.dim_activity_rule_info partition(dt='<span class="token variable">$do_date</span>')select    ar.id,    ar.activity_id,    ai.activity_name,    ar.activity_type,    ai.start_time,    ai.end_time,    ai.create_time,    ar.condition_amount,    ar.condition_num,    ar.benefit_amount,    ar.benefit_discount,    ar.benefit_levelfrom(    select        id,        activity_id,        activity_type,        condition_amount,        condition_num,        benefit_amount,        benefit_discount,        benefit_level    from <span class="token variable">$&#123;APP&#125;</span>.ods_activity_rule    where dt='<span class="token variable">$do_date</span>')arleft join(    select        id,        activity_name,        start_time,        end_time,        create_time    from <span class="token variable">$&#123;APP&#125;</span>.ods_activity_info    where dt='<span class="token variable">$do_date</span>')aion ar.activity_id=ai.id;"</span><span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span><span class="token string">"dim_user_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    hive -e <span class="token string">"<span class="token variable">$dim_user_info</span>"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token string">"dim_sku_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    hive -e <span class="token string">"<span class="token variable">$dim_sku_info</span>"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token string">"dim_base_province"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    hive -e <span class="token string">"<span class="token variable">$dim_base_province</span>"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token string">"dim_coupon_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    hive -e <span class="token string">"<span class="token variable">$dim_coupon_info</span>"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token string">"dim_activity_rule_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    hive -e <span class="token string">"<span class="token variable">$dim_activity_rule_info</span>"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token string">"all"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    hive -e <span class="token string">"<span class="token variable">$dim_user_info</span><span class="token variable">$dim_sku_info</span><span class="token variable">$dim_coupon_info</span><span class="token variable">$dim_activity_rule_info</span><span class="token variable">$dim_base_province</span>"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">esac</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ods-to-dim-db-每日同步脚本"><a href="#ods-to-dim-db-每日同步脚本" class="headerlink" title="ods_to_dim_db(每日同步脚本)"></a>ods_to_dim_db(每日同步脚本)</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">APP</span><span class="token operator">=</span>gmall<span class="token comment"># 如果是输入的日期按照取输入日期；如果没输入日期取当前时间的前一天</span><span class="token keyword">if</span> <span class="token punctuation">[</span> -n <span class="token string">"<span class="token variable">$2</span>"</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span><span class="token keyword">then</span>    <span class="token assign-left variable">do_date</span><span class="token operator">=</span><span class="token variable">$2</span><span class="token keyword">else</span>     <span class="token assign-left variable">do_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-1 day"</span> +%F<span class="token variable">`</span></span><span class="token keyword">fi</span><span class="token assign-left variable">dim_user_info</span><span class="token operator">=</span><span class="token string">"set hive.exec.dynamic.partition.mode=nonstrict;set hive.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat;withtmp as(    select        old.id old_id,        old.login_name old_login_name,        old.nick_name old_nick_name,        old.name old_name,        old.phone_num old_phone_num,        old.email old_email,        old.user_level old_user_level,        old.birthday old_birthday,        old.gender old_gender,        old.create_time old_create_time,        old.operate_time old_operate_time,        old.start_date old_start_date,        old.end_date old_end_date,        new.id new_id,        new.login_name new_login_name,        new.nick_name new_nick_name,        new.name new_name,        new.phone_num new_phone_num,        new.email new_email,        new.user_level new_user_level,        new.birthday new_birthday,        new.gender new_gender,        new.create_time new_create_time,        new.operate_time new_operate_time,        new.start_date new_start_date,        new.end_date new_end_date    from    (        select            id,            login_name,            nick_name,            name,            phone_num,            email,            user_level,            birthday,            gender,            create_time,            operate_time,            start_date,            end_date        from <span class="token variable">$&#123;APP&#125;</span>.dim_user_info        where dt='9999-99-99'        and start_date&lt;'<span class="token variable">$do_date</span>'    )old    full outer join    (        select            id,            login_name,            nick_name,            md5(name) name,            md5(phone_num) phone_num,            md5(email) email,            user_level,            birthday,            gender,            create_time,            operate_time,            '<span class="token variable">$do_date</span>' start_date,            '9999-99-99' end_date        from <span class="token variable">$&#123;APP&#125;</span>.ods_user_info        where dt='<span class="token variable">$do_date</span>'    )new    on old.id=new.id)insert overwrite table <span class="token variable">$&#123;APP&#125;</span>.dim_user_info partition(dt)select    nvl(new_id,old_id),    nvl(new_login_name,old_login_name),    nvl(new_nick_name,old_nick_name),    nvl(new_name,old_name),    nvl(new_phone_num,old_phone_num),    nvl(new_email,old_email),    nvl(new_user_level,old_user_level),    nvl(new_birthday,old_birthday),    nvl(new_gender,old_gender),    nvl(new_create_time,old_create_time),    nvl(new_operate_time,old_operate_time),    nvl(new_start_date,old_start_date),    nvl(new_end_date,old_end_date),    nvl(new_end_date,old_end_date) dtfrom tmpunion allselect    old_id,    old_login_name,    old_nick_name,    old_name,    old_phone_num,    old_email,    old_user_level,    old_birthday,    old_gender,    old_create_time,    old_operate_time,    old_start_date,    cast(date_add('<span class="token variable">$do_date</span>',-1) as string),    cast(date_add('<span class="token variable">$do_date</span>',-1) as string) dtfrom tmpwhere new_id is not null and old_id is not null;"</span><span class="token assign-left variable">dim_sku_info</span><span class="token operator">=</span><span class="token string">"set hive.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat;withsku as(    select        id,        price,        sku_name,        sku_desc,        weight,        is_sale,        spu_id,        category3_id,        tm_id,        create_time    from <span class="token variable">$&#123;APP&#125;</span>.ods_sku_info    where dt='<span class="token variable">$do_date</span>'),spu as(    select        id,        spu_name    from <span class="token variable">$&#123;APP&#125;</span>.ods_spu_info    where dt='<span class="token variable">$do_date</span>'),c3 as(    select        id,        name,        category2_id    from <span class="token variable">$&#123;APP&#125;</span>.ods_base_category3    where dt='<span class="token variable">$do_date</span>'),c2 as(    select        id,        name,        category1_id    from <span class="token variable">$&#123;APP&#125;</span>.ods_base_category2    where dt='<span class="token variable">$do_date</span>'),c1 as(    select        id,        name    from <span class="token variable">$&#123;APP&#125;</span>.ods_base_category1    where dt='<span class="token variable">$do_date</span>'),tm as(    select        id,        tm_name    from <span class="token variable">$&#123;APP&#125;</span>.ods_base_trademark    where dt='<span class="token variable">$do_date</span>'),attr as(    select        sku_id,        collect_set(named_struct('attr_id',attr_id,'value_id',value_id,'attr_name',attr_name,'value_name',value_name)) attrs    from <span class="token variable">$&#123;APP&#125;</span>.ods_sku_attr_value    where dt='<span class="token variable">$do_date</span>'    group by sku_id),sale_attr as(    select        sku_id,        collect_set(named_struct('sale_attr_id',sale_attr_id,'sale_attr_value_id',sale_attr_value_id,'sale_attr_name',sale_attr_name,'sale_attr_value_name',sale_attr_value_name)) sale_attrs    from <span class="token variable">$&#123;APP&#125;</span>.ods_sku_sale_attr_value    where dt='<span class="token variable">$do_date</span>'    group by sku_id)insert overwrite table <span class="token variable">$&#123;APP&#125;</span>.dim_sku_info partition(dt='<span class="token variable">$do_date</span>')select    sku.id,    sku.price,    sku.sku_name,    sku.sku_desc,    sku.weight,    sku.is_sale,    sku.spu_id,    spu.spu_name,    sku.category3_id,    c3.name,    c3.category2_id,    c2.name,    c2.category1_id,    c1.name,    sku.tm_id,    tm.tm_name,    attr.attrs,    sale_attr.sale_attrs,    sku.create_timefrom skuleft join spu on sku.spu_id=spu.idleft join c3 on sku.category3_id=c3.idleft join c2 on c3.category2_id=c2.idleft join c1 on c2.category1_id=c1.idleft join tm on sku.tm_id=tm.idleft join attr on sku.id=attr.sku_idleft join sale_attr on sku.id=sale_attr.sku_id;"</span><span class="token assign-left variable">dim_base_province</span><span class="token operator">=</span><span class="token string">"set hive.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat;insert overwrite table <span class="token variable">$&#123;APP&#125;</span>.dim_base_provinceselect    bp.id,    bp.name,    bp.area_code,    bp.iso_code,    bp.iso_3166_2,    bp.region_id,    bp.namefrom <span class="token variable">$&#123;APP&#125;</span>.ods_base_province bpjoin <span class="token variable">$&#123;APP&#125;</span>.ods_base_region br on bp.region_id = br.id;"</span><span class="token assign-left variable">dim_coupon_info</span><span class="token operator">=</span><span class="token string">"set hive.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat;insert overwrite table <span class="token variable">$&#123;APP&#125;</span>.dim_coupon_info partition(dt='<span class="token variable">$do_date</span>')select    id,    coupon_name,    coupon_type,    condition_amount,    condition_num,    activity_id,    benefit_amount,    benefit_discount,    create_time,    range_type,    limit_num,    taken_count,    start_time,    end_time,    operate_time,    expire_timefrom <span class="token variable">$&#123;APP&#125;</span>.ods_coupon_infowhere dt='<span class="token variable">$do_date</span>';"</span><span class="token assign-left variable">dim_activity_rule_info</span><span class="token operator">=</span><span class="token string">"set hive.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat;insert overwrite table <span class="token variable">$&#123;APP&#125;</span>.dim_activity_rule_info partition(dt='<span class="token variable">$do_date</span>')select    ar.id,    ar.activity_id,    ai.activity_name,    ar.activity_type,    ai.start_time,    ai.end_time,    ai.create_time,    ar.condition_amount,    ar.condition_num,    ar.benefit_amount,    ar.benefit_discount,    ar.benefit_levelfrom(    select        id,        activity_id,        activity_type,        condition_amount,        condition_num,        benefit_amount,        benefit_discount,        benefit_level    from <span class="token variable">$&#123;APP&#125;</span>.ods_activity_rule    where dt='<span class="token variable">$do_date</span>')arleft join(    select        id,        activity_name,        start_time,        end_time,        create_time    from <span class="token variable">$&#123;APP&#125;</span>.ods_activity_info    where dt='<span class="token variable">$do_date</span>')aion ar.activity_id=ai.id;"</span><span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span><span class="token string">"dim_user_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    hive -e <span class="token string">"<span class="token variable">$dim_user_info</span>"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token string">"dim_sku_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    hive -e <span class="token string">"<span class="token variable">$dim_sku_info</span>"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token string">"dim_base_province"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    hive -e <span class="token string">"<span class="token variable">$dim_base_province</span>"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token string">"dim_coupon_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    hive -e <span class="token string">"<span class="token variable">$dim_coupon_info</span>"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token string">"dim_activity_rule_info"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    hive -e <span class="token string">"<span class="token variable">$dim_activity_rule_info</span>"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token string">"all"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    hive -e <span class="token string">"<span class="token variable">$dim_user_info</span><span class="token variable">$dim_sku_info</span><span class="token variable">$dim_coupon_info</span><span class="token variable">$dim_activity_rule_info</span>"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">esac</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="将ods层数据同步到dwd层"><a href="#将ods层数据同步到dwd层" class="headerlink" title="将ods层数据同步到dwd层"></a>将ods层数据同步到dwd层</h2><h3 id="ods-to-dwd-log"><a href="#ods-to-dwd-log" class="headerlink" title="ods_to_dwd_log"></a>ods_to_dwd_log</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">APP</span><span class="token operator">=</span>gmall<span class="token comment"># 如果是输入的日期按照取输入日期；如果没输入日期取当前时间的前一天</span><span class="token keyword">if</span> <span class="token punctuation">[</span> -n <span class="token string">"<span class="token variable">$2</span>"</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span><span class="token keyword">then</span>    <span class="token assign-left variable">do_date</span><span class="token operator">=</span><span class="token variable">$2</span><span class="token keyword">else</span>     <span class="token assign-left variable">do_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-1 day"</span> +%F<span class="token variable">`</span></span><span class="token keyword">fi</span><span class="token assign-left variable">dwd_start_log</span><span class="token operator">=</span><span class="token string">"set hive.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat;insert overwrite table <span class="token variable">$&#123;APP&#125;</span>.dwd_start_log partition(dt='<span class="token variable">$do_date</span>')select    get_json_object(line,'$.common.ar'),    get_json_object(line,'$.common.ba'),    get_json_object(line,'$.common.ch'),    get_json_object(line,'$.common.is_new'),    get_json_object(line,'$.common.md'),    get_json_object(line,'$.common.mid'),    get_json_object(line,'$.common.os'),    get_json_object(line,'$.common.uid'),    get_json_object(line,'$.common.vc'),    get_json_object(line,'$.start.entry'),    get_json_object(line,'$.start.loading_time'),    get_json_object(line,'$.start.open_ad_id'),    get_json_object(line,'$.start.open_ad_ms'),    get_json_object(line,'$.start.open_ad_skip_ms'),    get_json_object(line,'$.ts')from <span class="token variable">$&#123;APP&#125;</span>.ods_logwhere dt='<span class="token variable">$do_date</span>'and get_json_object(line,'$.start') is not null;"</span><span class="token assign-left variable">dwd_page_log</span><span class="token operator">=</span><span class="token string">"set hive.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat;insert overwrite table <span class="token variable">$&#123;APP&#125;</span>.dwd_page_log partition(dt='<span class="token variable">$do_date</span>')select    get_json_object(line,'$.common.ar'),    get_json_object(line,'$.common.ba'),    get_json_object(line,'$.common.ch'),    get_json_object(line,'$.common.is_new'),    get_json_object(line,'$.common.md'),    get_json_object(line,'$.common.mid'),    get_json_object(line,'$.common.os'),    get_json_object(line,'$.common.uid'),    get_json_object(line,'$.common.vc'),    get_json_object(line,'$.page.during_time'),    get_json_object(line,'$.page.item'),    get_json_object(line,'$.page.item_type'),    get_json_object(line,'$.page.last_page_id'),    get_json_object(line,'$.page.page_id'),    get_json_object(line,'$.page.source_type'),    get_json_object(line,'$.ts')from <span class="token variable">$&#123;APP&#125;</span>.ods_logwhere dt='<span class="token variable">$do_date</span>'and get_json_object(line,'$.page') is not null;"</span><span class="token assign-left variable">dwd_action_log</span><span class="token operator">=</span><span class="token string">"set hive.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat;insert overwrite table <span class="token variable">$&#123;APP&#125;</span>.dwd_action_log partition(dt='<span class="token variable">$do_date</span>')select    get_json_object(line,'$.common.ar'),    get_json_object(line,'$.common.ba'),    get_json_object(line,'$.common.ch'),    get_json_object(line,'$.common.is_new'),    get_json_object(line,'$.common.md'),    get_json_object(line,'$.common.mid'),    get_json_object(line,'$.common.os'),    get_json_object(line,'$.common.uid'),    get_json_object(line,'$.common.vc'),    get_json_object(line,'$.page.during_time'),    get_json_object(line,'$.page.item'),    get_json_object(line,'$.page.item_type'),    get_json_object(line,'$.page.last_page_id'),    get_json_object(line,'$.page.page_id'),    get_json_object(line,'$.page.source_type'),    get_json_object(action,'$.action_id'),    get_json_object(action,'$.item'),    get_json_object(action,'$.item_type'),    get_json_object(action,'$.ts')from <span class="token variable">$&#123;APP&#125;</span>.ods_log lateral view <span class="token variable">$&#123;APP&#125;</span>.explode_json_array(get_json_object(line,'$.actions')) tmp as actionwhere dt='<span class="token variable">$do_date</span>'and get_json_object(line,'$.actions') is not null;"</span><span class="token assign-left variable">dwd_display_log</span><span class="token operator">=</span><span class="token string">"set hive.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat;insert overwrite table <span class="token variable">$&#123;APP&#125;</span>.dwd_display_log partition(dt='<span class="token variable">$do_date</span>')select    get_json_object(line,'$.common.ar'),    get_json_object(line,'$.common.ba'),    get_json_object(line,'$.common.ch'),    get_json_object(line,'$.common.is_new'),    get_json_object(line,'$.common.md'),    get_json_object(line,'$.common.mid'),    get_json_object(line,'$.common.os'),    get_json_object(line,'$.common.uid'),    get_json_object(line,'$.common.vc'),    get_json_object(line,'$.page.during_time'),    get_json_object(line,'$.page.item'),    get_json_object(line,'$.page.item_type'),    get_json_object(line,'$.page.last_page_id'),    get_json_object(line,'$.page.page_id'),    get_json_object(line,'$.page.source_type'),    get_json_object(line,'$.ts'),    get_json_object(display,'$.display_type'),    get_json_object(display,'$.item'),    get_json_object(display,'$.item_type'),    get_json_object(display,'$.order'),    get_json_object(display,'$.pos_id')from <span class="token variable">$&#123;APP&#125;</span>.ods_log lateral view <span class="token variable">$&#123;APP&#125;</span>.explode_json_array(get_json_object(line,'$.displays')) tmp as displaywhere dt='<span class="token variable">$do_date</span>'and get_json_object(line,'$.displays') is not null;"</span><span class="token assign-left variable">dwd_error_log</span><span class="token operator">=</span><span class="token string">"set hive.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat;insert overwrite table <span class="token variable">$&#123;APP&#125;</span>.dwd_error_log partition(dt='<span class="token variable">$do_date</span>')select    get_json_object(line,'$.common.ar'),    get_json_object(line,'$.common.ba'),    get_json_object(line,'$.common.ch'),    get_json_object(line,'$.common.is_new'),    get_json_object(line,'$.common.md'),    get_json_object(line,'$.common.mid'),    get_json_object(line,'$.common.os'),    get_json_object(line,'$.common.uid'),    get_json_object(line,'$.common.vc'),    get_json_object(line,'$.page.item'),    get_json_object(line,'$.page.item_type'),    get_json_object(line,'$.page.last_page_id'),    get_json_object(line,'$.page.page_id'),    get_json_object(line,'$.page.source_type'),    get_json_object(line,'$.start.entry'),    get_json_object(line,'$.start.loading_time'),    get_json_object(line,'$.start.open_ad_id'),    get_json_object(line,'$.start.open_ad_ms'),    get_json_object(line,'$.start.open_ad_skip_ms'),    get_json_object(line,'$.actions'),    get_json_object(line,'$.displays'),    get_json_object(line,'$.ts'),    get_json_object(line,'$.err.error_code'),    get_json_object(line,'$.err.msg')from <span class="token variable">$&#123;APP&#125;</span>.ods_logwhere dt='<span class="token variable">$do_date</span>'and get_json_object(line,'$.err') is not null;"</span><span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span>    dwd_start_log <span class="token punctuation">)</span>        hive -e <span class="token string">"<span class="token variable">$dwd_start_log</span>"</span>    <span class="token punctuation">;</span><span class="token punctuation">;</span>    dwd_page_log <span class="token punctuation">)</span>        hive -e <span class="token string">"<span class="token variable">$dwd_page_log</span>"</span>    <span class="token punctuation">;</span><span class="token punctuation">;</span>    dwd_action_log <span class="token punctuation">)</span>        hive -e <span class="token string">"<span class="token variable">$dwd_action_log</span>"</span>    <span class="token punctuation">;</span><span class="token punctuation">;</span>    dwd_display_log <span class="token punctuation">)</span>        hive -e <span class="token string">"<span class="token variable">$dwd_display_log</span>"</span>    <span class="token punctuation">;</span><span class="token punctuation">;</span>    dwd_error_log <span class="token punctuation">)</span>        hive -e <span class="token string">"<span class="token variable">$dwd_error_log</span>"</span>    <span class="token punctuation">;</span><span class="token punctuation">;</span>    all <span class="token punctuation">)</span>        hive -e <span class="token string">"<span class="token variable">$dwd_start_log</span><span class="token variable">$dwd_page_log</span><span class="token variable">$dwd_action_log</span><span class="token variable">$dwd_display_log</span><span class="token variable">$dwd_error_log</span>"</span>    <span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token keyword">esac</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> shell </category>
          
          <category> Data Warehouse </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hadoop端口使用情况汇总(记)</title>
      <link href="/2021/11/17/hadoop-duan-kou/"/>
      <url>/2021/11/17/hadoop-duan-kou/</url>
      
        <content type="html"><![CDATA[<h2 id="汇总表"><a href="#汇总表" class="headerlink" title="汇总表"></a>汇总表</h2><table><thead><tr><th align="center">端口名称</th><th align="center">hadoop2.x</th><th align="center">hadoop3.x</th></tr></thead><tbody><tr><td align="center">NameNode内部通信端口</td><td align="center"><font color="red">8082</font>/9000</td><td align="center"><font color="red">8082</font>/9000/9820</td></tr><tr><td align="center">NameNode Web端口</td><td align="center"><font color="red">50070</font></td><td align="center"><font color="red">9870</font></td></tr><tr><td align="center">MapReduce查看执行任务端口</td><td align="center">8088</td><td align="center">8088</td></tr><tr><td align="center">历史服务器 WEB端口</td><td align="center">19888</td><td align="center">19888</td></tr></tbody></table><h2 id="NameNode"><a href="#NameNode" class="headerlink" title="NameNode"></a>NameNode</h2><h3 id="服务器端口"><a href="#服务器端口" class="headerlink" title="服务器端口"></a>服务器端口</h3><p>core-site.xml</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- 指定NameNode的地址 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>fs.defaultFS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hdfs://hadoop102:8020<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="web端口"><a href="#web端口" class="headerlink" title="web端口"></a>web端口</h3><p>hdfs-site.xml</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- nn web端访问地址--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.namenode.http-address<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hadoop102:9870<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="SeconderyNameNode"><a href="#SeconderyNameNode" class="headerlink" title="SeconderyNameNode"></a>SeconderyNameNode</h2><h3 id="web端"><a href="#web端" class="headerlink" title="web端"></a>web端</h3><p>9868<br>hdfs-site.xml</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- 2nn web端访问地址--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.namenode.secondary.http-address<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hadoop104:9868<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="历史服务器的端口配置："><a href="#历史服务器的端口配置：" class="headerlink" title="历史服务器的端口配置："></a>历史服务器的端口配置：</h2><ul><li><p>   服务器:<br>10020</p></li><li><p>   web端：<br>19888</p></li></ul><h3 id="服务器端"><a href="#服务器端" class="headerlink" title="服务器端"></a>服务器端</h3><p>mapred-site.xml</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&lt;!-- 历史服务器端地址 --&gt;&lt;property&gt;&lt;name&gt;mapreduce.jobhistory.address&lt;&#x2F;name&gt;    &lt;value&gt;hadoop101:10020&lt;&#x2F;value&gt;&lt;&#x2F;property&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="web端-1"><a href="#web端-1" class="headerlink" title="web端"></a>web端</h3><p>mapred-site.xml</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&lt;!-- 历史服务器web端地址 --&gt;&lt;property&gt;&lt;name&gt;mapreduce.jobhistory.webapp.address&lt;&#x2F;name&gt;    &lt;value&gt;hadoop102:19888&lt;&#x2F;value&gt;&lt;&#x2F;property&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> hadoop </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hadoop端口 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数仓分成</title>
      <link href="/2021/11/17/shu-ju-cang-ku-fen-ceng/"/>
      <url>/2021/11/17/shu-ju-cang-ku-fen-ceng/</url>
      
        <content type="html"><![CDATA[<h2 id="数据库分层图"><a href="#数据库分层图" class="headerlink" title="数据库分层图"></a>数据库分层图</h2><p><img src="/2021/11/17/shu-ju-cang-ku-fen-ceng/387d3d14-02d2-4a6d-940c-29fa6232be81.png"></p><h2 id="数据库各层的功能解析"><a href="#数据库各层的功能解析" class="headerlink" title="数据库各层的功能解析"></a>数据库各层的功能解析</h2><ol><li><p>ODS：元数据层，对于原始数据的一个备份</p></li><li><p>DWD：数据明细层，对数据的一个清洗（判空过滤，去除脏数据），保存业务事实明细，一行数据代表用户的一次业务行为。如：一次下单。</p></li><li><p>ADS：数据应用层，为各种报表提供数据支持。</p></li><li><p>DIM：维度层，对数据的维度建模主要是业务事实信息的描述。何人，何时，何地</p></li><li><p>DWS：服务数据层，按天进行轻度汇总。一行信息代表一个主题对象的一天汇总行为。</p></li><li><p>DWT：主题数据层，数据累计汇总，一行信息代表一个主题对象的一段时间数据的累计汇总。</p></li></ol><h2 id="为什么要数据分层："><a href="#为什么要数据分层：" class="headerlink" title="为什么要数据分层："></a>为什么要数据分层：</h2><ol><li><p>隔离原始数据：对数据进行备份，解耦（将原始数据和统计数据据解耦开）。</p></li><li><p>减少重复开发：规范数据分层，通过中间层数据，减少数据的重复开发，一次计算多次复用。</p></li><li><p>把复杂任务简单化： 把任务分层处理，每层只处理简单问题。方便问题的定位。<br>命名规范</p></li></ol><hr><ul><li>   表名</li></ul><p>Ø  ODS层命名为ods_表名</p><p>Ø  DIM层命名为dim_表名</p><p>Ø  DWD层命名为dwd_表名</p><p>Ø  DWS层命名为dws_表名  </p><p>Ø  DWT层命名为dwt_表名</p><p>Ø  ADS层命名为ads_表名</p><p>Ø  临时表命名为tmp_表名</p><ul><li>脚本名<br>数据源_to_目标_db/log.sh<br>行为数据：log<br>业务数据：db</li><li>   字段类型<br>金钱：decimal(16,2), edit:16表示16位有效数字，2表示，其中小数部分为2位<br>数量：bigint<br>时间戳类型：bigint</li></ul><p>主外键类型为：string<br>建模理论</p><hr><h3 id="关系建模"><a href="#关系建模" class="headerlink" title="关系建模"></a>关系建模</h3><p>遵循三范式</p><ol><li><p>属性不可切</p></li><li><p>部分函数依赖不可有<br> 非主键不可部分函数依赖于主键</p></li><li><p>传递函数依赖不可有<br> 非主键不可传递函数依赖于主键</p></li></ol><h3 id="维度建模"><a href="#维度建模" class="headerlink" title="维度建模"></a>维度建模</h3><h4 id="维度表"><a href="#维度表" class="headerlink" title="维度表"></a>维度表</h4><p>对事实的描述。包含大量属性。</p><h4 id="事实表"><a href="#事实表" class="headerlink" title="事实表"></a>事实表</h4><p>业务事件</p><p>维度表的外键+度量值</p><ul><li>事实表的类型分类：</li></ul><ol><li>事务型事实表<br>使用增量同步</li><li>周期型快照事实表<br>使用全量同步</li><li>累积周期性快照事实表<br>使用增量修改同步</li></ol><p><strong>业务总线矩阵</strong></p><table><thead><tr><th align="left">事实\维度</th><th align="center">时间</th><th align="center">用户</th><th align="center">地区</th><th align="center">商品</th><th align="center">优惠券</th><th align="center">活动</th><th align="center">度量值</th></tr></thead><tbody><tr><td align="left">订单</td><td align="center">&radic;</td><td align="center">&radic;</td><td align="center">&radic;</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">运费,优惠金额</td></tr><tr><td align="left">订单明细</td><td align="center">&radic;</td><td align="center">&radic;</td><td align="center">&radic;</td><td align="center">&radic;</td><td align="center">&radic;</td><td align="center">&radic;</td><td align="center">商品件数,订单金额,优惠金额</td></tr><tr><td align="left">支付</td><td align="center">&radic;</td><td align="center">&radic;</td><td align="center">&radic;</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">支付金额</td></tr><tr><td align="left">加购</td><td align="center">&radic;</td><td align="center">&radic;</td><td align="center"></td><td align="center">&radic;</td><td align="center"></td><td align="center"></td><td align="center">商品件数,金额</td></tr><tr><td align="left">收藏</td><td align="center">&radic;</td><td align="center">&radic;</td><td align="center"></td><td align="center">&radic;</td><td align="center"></td><td align="center"></td><td align="center">收藏次数(1)</td></tr><tr><td align="left">退单</td><td align="center">&radic;</td><td align="center">&radic;</td><td align="center"></td><td align="center">&radic;</td><td align="center"></td><td align="center"></td><td align="center">商品件数,退单金额</td></tr><tr><td align="left">退款</td><td align="center">&radic;</td><td align="center">&radic;</td><td align="center"></td><td align="center">&radic;</td><td align="center"></td><td align="center"></td><td align="center">商品件数,退款金额</td></tr><tr><td align="left">评价</td><td align="center">&radic;</td><td align="center">&radic;</td><td align="center"></td><td align="center">&radic;</td><td align="center"></td><td align="center"></td><td align="center">评价次数(1)</td></tr><tr><td align="left">优惠券领用</td><td align="center">&radic;</td><td align="center">&radic;</td><td align="center"></td><td align="center"></td><td align="center">&radic;</td><td align="center"></td><td align="center">领券次数(1)</td></tr></tbody></table><ul><li><input checked disabled type="checkbox"> 理解没有</li></ul>]]></content>
      
      
      <categories>
          
          <category> Data Warehouse </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Data Warehouse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git常规指令</title>
      <link href="/2021/11/17/git-chang-gui-zhi-ling/"/>
      <url>/2021/11/17/git-chang-gui-zhi-ling/</url>
      
        <content type="html"><![CDATA[<h1 id="一些常用指令汇总"><a href="#一些常用指令汇总" class="headerlink" title="一些常用指令汇总"></a>一些常用指令汇总</h1><ul><li> edit:<br>  昨天提交考试作业,需要提交到gitee上的分支上.因为很久没用git了,有点忘记了.今早在此做一次昨天命令汇总复习吧.</li></ul><h2 id="首先建立本地仓库-初始化"><a href="#首先建立本地仓库-初始化" class="headerlink" title="首先建立本地仓库,初始化"></a>首先建立本地仓库,初始化</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">git init<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="remote-一下远程仓库"><a href="#remote-一下远程仓库" class="headerlink" title="remote 一下远程仓库"></a>remote 一下远程仓库</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">git remote add origin https:&#x2F;&#x2F;gitee.com&#x2F;xxxx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="pull一下我的分支-学号"><a href="#pull一下我的分支-学号" class="headerlink" title="pull一下我的分支(学号)"></a>pull一下我的分支(学号)</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">git pull origin 学号<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="添加本地仓库"><a href="#添加本地仓库" class="headerlink" title="添加本地仓库"></a>添加本地仓库</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">git add .<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="commite-一下"><a href="#commite-一下" class="headerlink" title="commite 一下"></a>commite 一下</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">git commit -m &quot;初始&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="切换分支到我的学号"><a href="#切换分支到我的学号" class="headerlink" title="切换分支到我的学号"></a>切换分支到我的学号</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">git checkout 学号<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="push到仓库分支"><a href="#push到仓库分支" class="headerlink" title="push到仓库分支"></a>push到仓库分支</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">git push origin 学号<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="删除本地仓库"><a href="#删除本地仓库" class="headerlink" title="删除本地仓库"></a>删除本地仓库</h2><p>**edit:**直接把本地的”.git”文件删除就行了,采用shell命令</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">find . -name &quot;.git&quot;|xargs rm -rf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UDTF原理</title>
      <link href="/2021/11/16/udtf/"/>
      <url>/2021/11/16/udtf/</url>
      
        <content type="html"><![CDATA[<h2 id="原理解释"><a href="#原理解释" class="headerlink" title="原理解释"></a>原理解释</h2><p>Hive 的每一个sql会被解释成一个个的operator组成operators,<br>数据放在java中的object中,<br>数据类型放在object inspector中<br>在oprator之间传递.</p><blockquote><p>edit:<br>(object inspector提供了用以解析保存在object中的数据的方法)</p></blockquote><p><img src="https://img-blog.csdnimg.cn/b45be8e0b8894b7c97973d2b0769f95c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5oiR5piv5aW95Lq65aSn5oCq5YW9,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="这是从我的csdn引用的"><br><img src="/2021/11/16/udtf/udtf.png" alt="这是安装插件后,从相对路径引用的"><br><a href="https://f60bec40.wiz06.com/wapp/pages/view/share/s/3S2-N02Et17F2tGvlH3MdUWD0HjvNV08rABS2UL3b20OfkF7">我的为知笔记</a></p>]]></content>
      
      
      <categories>
          
          <category> hive </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hive </tag>
            
            <tag> udtf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>电商数仓-测试与优化</title>
      <link href="/2021/11/16/ebdw-testandoptimize/"/>
      <url>/2021/11/16/ebdw-testandoptimize/</url>
      
        <content type="html"><![CDATA[<h1 id="电商数据仓库项目"><a href="#电商数据仓库项目" class="headerlink" title="电商数据仓库项目"></a>电商数据仓库项目</h1><h2 id="基准测试"><a href="#基准测试" class="headerlink" title="基准测试"></a>基准测试</h2><h3 id="为什么要做基准测试"><a href="#为什么要做基准测试" class="headerlink" title="为什么要做基准测试?"></a>为什么要做基准测试?</h3><p>在企业中非常关心每天从Java后台拉取过来的数据，需要多久能上传到集群？消费者关心多久能从HDFS上拉取需要的数据？</p><p>为了搞清楚HDFS的读写性能，生产环境上非常需要对集群进行压测。</p><h3 id="怎么做"><a href="#怎么做" class="headerlink" title="怎么做"></a>怎么做</h3><ul><li> <strong>第一步</strong>,<em><strong>设置统一网络传输速度</strong></em>    *    hadoop102、hadoop103、hadoop104虚拟机网络都设置为100mbps。<br>  原因:HDFS的读写性能主要受网络和磁盘影响比较大。<br>edit:    100Mbps单位是bit；10M/s单位是byte ; 1byte=8bit，100Mbps/8=12.5M/s。<br><img src="/2021/11/16/ebdw-testandoptimize/b5795d33-9457-458f-95ac-85505eb55a88.png">    * 开启python的简单http服务器进行网速测试  <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">    [tzk@hadoop101 module]$ python -m SimpleHTTPServerServing HTTP on 0.0.0.0 port 8000 ...192.168.32.1 - - [07&#x2F;Oct&#x2F;2021 19:42:38] &quot;GET &#x2F; HTTP&#x2F;1.1&quot; 200 -192.168.32.1 - - [07&#x2F;Oct&#x2F;2021 19:42:38] code 404, message File not found192.168.32.1 - - [07&#x2F;Oct&#x2F;2021 19:42:38] &quot;GET &#x2F;favicon.ico HTTP&#x2F;1.1&quot; 404 -192.168.32.1 - - [07&#x2F;Oct&#x2F;2021 19:42:43] &quot;GET &#x2F;bigtable.lzo HTTP&#x2F;1.1&quot; 200 -<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>    * 验证结果  <img src="/2021/11/16/ebdw-testandoptimize/fd789e7f-76c7-40e4-889a-96d36d6f8bc6.png"></li><li><strong>第二步</strong>,<em><strong>测试hdfs的写性能</strong></em><br>向HDFS写10个128M的文件<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[tzk@hadoop101 hadoop-3.1.3]$ hadoop jar share&#x2F;hadoop&#x2F;mapreduce&#x2F;hadoop-mapreduce-client-jobclient-3.1.3-tests.jar TestDFSIO -write -nrFiles 10 -fileSize 128MB <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="/2021/11/16/ebdw-testandoptimize/a0baf880-9449-4ebf-a71f-42a940f3c368.png"><br>两个平均数:<ul><li>第一个的计算方式: 所有数据量相加 <strong>/</strong> 总时间</li><li>第二个的计算方式: 每一个map的平均速度相加</li></ul></li></ul><p>由上图可以看出,这两个平均速度远远大于网络速度.很明显,这里走的是磁盘,并没有走网络.<br>即:只在hadoop101上运行,因为我们在一开始把备份数改成了1.现在去hdfs-site.xml进行修改为3<br><strong>来看一下运行结果图</strong><br><img src="/2021/11/16/ebdw-testandoptimize/4fd8e791-e9dd-4082-a425-caddb58e8a29.png"><br>10个任务,由于我们的客户端是在hadoop101上,所以网络传输为 10*20分.<br>那么传输速度为:<br>v X 20<br>实测数据: 1.77 * 20 = 35.4<br>每台服务器速度(按最大值:100 / 8 = 12.5)相加: 12.5 + 12.5 + 12.5 = 37.5<br>由此可得,带宽已经跑满了</p><ul><li><strong>第三步</strong>,<em><strong>测试HDFS的读性能</strong></em><br>客户端: hadoop101<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[tzk@hadoop101 hadoop-3.1.3]$ hadoop jar share&#x2F;hadoop&#x2F;mapreduce&#x2F;hadoop-mapreduce-client-jobclient-3.1.3-tests.jar TestDFSIO -read -nrFiles 10 -fileSize 128MB<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><em>测试结果图:</em>*<br><img src="/2021/11/16/ebdw-testandoptimize/57facd70-6104-4316-8214-83f523968f9c.png"></li></ul><p><strong>最后</strong>,<em><strong>删除测试生成数据</strong></em></p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[tzk@hadoop101 hadoop-3.1.3]$ hadoop jar share&#x2F;hadoop&#x2F;mapreduce&#x2F;hadoop-mapreduce-client-jobclient-3.1.3-tests.jar TestDFSIO -clean<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="使用Sort程序评测MapReduce"><a href="#使用Sort程序评测MapReduce" class="headerlink" title="使用Sort程序评测MapReduce"></a><em><strong>使用Sort程序评测MapReduce</strong></em></h3><p>（1）使用RandomWriter来产生随机数，每个节点运行10个Map任务，每个Map产生大约1G大小的二进制随机数</p><pre class="line-numbers language-none"><code class="language-none">[atguigu@hadoop102 mapreduce]$ hadoop jar &#x2F;opt&#x2F;module&#x2F;hadoop-3.1.3&#x2F;share&#x2F;hadoop&#x2F;mapreduce&#x2F;hadoop-mapreduce-examples-3.1.3.jar randomwriter random-data<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>（2）执行Sort程序</p><pre class="line-numbers language-none"><code class="language-none">[atguigu@hadoop102 mapreduce]$ hadoop jar &#x2F;opt&#x2F;module&#x2F;hadoop-3.1.3&#x2F;share&#x2F;hadoop&#x2F;mapreduce&#x2F;hadoop-mapreduce-examples-3.1.3.jar sort random-data sorted-data<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>（3）验证数据是否真正排好序了</p><pre class="line-numbers language-none"><code class="language-none">[atguigu@hadoop102 mapreduce]$hadoop jar &#x2F;opt&#x2F;module&#x2F;hadoop-3.1.3&#x2F;share&#x2F;hadoop&#x2F;mapreduce&#x2F;hadoop-mapreduce-client-jobclient-3.1.3-tests.jar testmapredsort -sortInput random-data -sortOutput sorted-data<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="hadoop参数调优"><a href="#hadoop参数调优" class="headerlink" title="hadoop参数调优"></a>hadoop参数调优</h2><h3 id="1-）HDFS参数调优"><a href="#1-）HDFS参数调优" class="headerlink" title="1 ）HDFS参数调优"></a><strong>1</strong> ）HDFS参数调优</h3><p><strong>hdfs-site.xml</strong></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml">NameNode有一个工作线程池，用来处理不同DataNode的并发心跳以及客户端并发的元数据操作。对于大集群或者有大量客户端的集群来说，通常需要增大参数dfs.namenode.handler.count的默认值10。<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.namenode.handler.count<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>计算公式</strong><br><img src="/2021/11/16/ebdw-testandoptimize/bb5a529f-803b-4b8b-ad8c-27ca2108be24.png"></p><p>通过python实现计算</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[tzk@hadoop101 hadoop-3.1.3]$ pythonPython 2.7.5 (default, Apr  2 2020, 13:16:51) [GCC 4.8.5 20150623 (Red Hat 4.8.5-39)] on linux2Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.&gt;&gt;&gt; import math&gt;&gt;&gt; print int(20*math.log(3))21&gt;&gt;&gt; quit()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-）YARN参数调优"><a href="#2-）YARN参数调优" class="headerlink" title="2 ）YARN参数调优"></a><strong>2</strong> ）YARN参数调优</h3><p><strong>yarn-site.xml</strong><br>（1）情景描述：总共7台机器，每天几亿条数据，数据源-&gt;Flume-&gt;Kafka-&gt;HDFS-&gt;Hive</p><p>面临问题：数据统计主要用HiveSQL，没有数据倾斜，小文件已经做了合并处理，开启的JVM重用，而且IO没有阻塞，内存用了不到50%。但是还是跑的非常慢，而且数据量洪峰过来时，整个集群都会宕掉。基于这种情况有没有优化方案。</p><p>（2）解决办法：</p><p>NodeManager内存和服务器实际内存配置尽量接近，如服务器有128g内存，但是NodeManager默认内存8G，不修改该参数最多只能用8G内存。NodeManager使用的CPU核数和服务器CPU核数尽量接近。</p><p>①yarn.nodemanager.resource.memory-mb   NodeManager使用内存数</p><p>②yarn.nodemanager.resource.cpu-vcores  NodeManager使用CPU核数</p><h2 id="kafka压测"><a href="#kafka压测" class="headerlink" title="kafka压测"></a>kafka压测</h2><h3 id="生产压测"><a href="#生产压测" class="headerlink" title="生产压测"></a>生产压测</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">kafka-topics.sh --zookeeper hadoop101:2181,hadoop102:2181,hadoop103:2181&#x2F;kafka --create --replication-factor 2 --partitions 3 --topic test#再来一遍kafka-topics.sh --zookeeper hadoop101:2181,hadoop102:2181,hadoop103:2181&#x2F;kafka --create --replication-factor 2 partitions 3 --topic test#在来亿遍kafka-topics.sh --zookeeper hadoop101:2181,hadoop102:2181,hadoop103:2181&#x2F;kafka --create --replication-factor 2 --partitions 3 --topic test#生产测试kafka-producer-perf-test.sh  --topic test --record-size 100 --num-records 10000000 --throughput -1 --producer-props bootstrap.servers&#x3D;hadoop101:9092,hadoop102:9092,hadoop103:9092kafka-producer-perf-test.sh --topic test --record-size 100 --num-records 10000000 --throughput -1 --producer-props bootstrap.servers&#x3D;hadoop101:9092,hadoop102:9092,hadoop103:9092<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>测试结果图:<br><img src="/2021/11/16/ebdw-testandoptimize/25ec958a-9caf-446e-b8f1-3108cc678cb9.png"><br>集群总带宽: 12.5 + 12.5 + 12.5 约等于 10 + 10 + 10 = 30M/s<br>由于有两个副本,则传输速度应该为: 30 / 2 = 15M/s<br><font color="red"><em>测试结果与预期相符</em></font></p><h3 id="消费压测"><a href="#消费压测" class="headerlink" title="消费压测"></a>消费压测</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">kafka-consumer-perf-test.sh --broker-list hadoop101:9092,hadoop102:9092,hadoop103:9092 --topic test --fetch-size 10000 --messages 10000000 --threads 1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/2021/11/16/ebdw-testandoptimize/0f7172e2-a88d-470a-ac6c-836b934c59af.png"><br>将 fetch-size的值加大10倍</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># threads 地址对结果没影响,因为底层源码中并没有调取它kafka-consumer-perf-test.sh --broker-list hadoop101:9092,hadoop102:9092,hadoop103:9092 --topic test --fetch-size 100000 --messages 10000000 --threads 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/2021/11/16/ebdw-testandoptimize/d59fa9ae-e296-4409-8b77-dd151b80559b.png"></p>]]></content>
      
      
      <categories>
          
          <category> Data Warehouse </category>
          
          <category> bigdata </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Data Warehouse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql基础</title>
      <link href="/2021/11/16/mysql-ji-chu/"/>
      <url>/2021/11/16/mysql-ji-chu/</url>
      
        <content type="html"><![CDATA[<h2 id="数据库的好处"><a href="#数据库的好处" class="headerlink" title="数据库的好处"></a>数据库的好处</h2><pre><code>1.持久化数据到本地2.可以实现结构化查询，方便管理</code></pre><h2 id="数据库相关概念"><a href="#数据库相关概念" class="headerlink" title="数据库相关概念"></a>数据库相关概念</h2><pre><code>1、DB：数据库，保存一组有组织的数据的容器2、DBMS：数据库管理系统，又称为数据库软件（产品），用于管理DB中的数据3、SQL:结构化查询语言，用于和DBMS通信的语言</code></pre><h2 id="数据库存储数据的特点"><a href="#数据库存储数据的特点" class="headerlink" title="数据库存储数据的特点"></a>数据库存储数据的特点</h2><pre><code>1、将数据放到表中，表再放到库中2、一个数据库中可以有多个表，每个表都有一个的名字，用来标识自己。表名具有唯一性。3、表具有一些特性，这些特性定义了数据在表中如何存储，类似java中 “类”的设计。4、表由列组成，我们也称为字段。所有表都是由一个或多个列组成的，每一列类似java 中的”属性”5、表中的数据是按行存储的，每一行类似于java中的“对象”。</code></pre><h2 id="MySQL产品的介绍和安装"><a href="#MySQL产品的介绍和安装" class="headerlink" title="MySQL产品的介绍和安装"></a>MySQL产品的介绍和安装</h2><h3 id="MySQL服务的启动和停止"><a href="#MySQL服务的启动和停止" class="headerlink" title="MySQL服务的启动和停止"></a>MySQL服务的启动和停止</h3><pre><code>方式一：计算机——右击管理——服务方式二：通过管理员身份运行net start 服务名（启动服务）net stop 服务名（停止服务）</code></pre><h3 id="MySQL服务的登录和退出"><a href="#MySQL服务的登录和退出" class="headerlink" title="MySQL服务的登录和退出"></a>MySQL服务的登录和退出</h3><pre><code>方式一：通过mysql自带的客户端只限于root用户方式二：通过windows自带的客户端登录：mysql 【-h主机名 -P端口号 】-u用户名 -p密码退出：exit或ctrl+C</code></pre><h3 id="MySQL的常见命令"><a href="#MySQL的常见命令" class="headerlink" title="MySQL的常见命令"></a>MySQL的常见命令</h3><pre><code>1.查看当前所有的数据库show databases;2.打开指定的库use 库名3.查看当前库的所有表show tables;4.查看其它库的所有表show tables from 库名;5.创建表create table 表名(    列名 列类型,    列名 列类型，    。。。);6.查看表结构desc 表名;7.查看服务器的版本方式一：登录到mysql服务端select version();方式二：没有登录到mysql服务端mysql --version或mysql --V</code></pre><h3 id="MySQL的语法规范"><a href="#MySQL的语法规范" class="headerlink" title="MySQL的语法规范"></a>MySQL的语法规范</h3><pre><code>1.不区分大小写,但建议关键字大写，表名、列名小写2.每条命令最好用分号结尾3.每条命令根据需要，可以进行缩进 或换行4.注释    单行注释：#注释文字    单行注释：-- 注释文字    多行注释：/* 注释文字  */</code></pre><h3 id="SQL的语言分类"><a href="#SQL的语言分类" class="headerlink" title="SQL的语言分类"></a>SQL的语言分类</h3><pre><code>DQL（Data Query Language）：数据查询语言    select DML(Data Manipulate Language):数据操作语言    insert 、update、deleteDDL（Data Define Languge）：数据定义语言    create、drop、alterTCL（Transaction Control Language）：事务控制语言    commit、rollback</code></pre><h3 id="SQL的常见命令"><a href="#SQL的常见命令" class="headerlink" title="SQL的常见命令"></a>SQL的常见命令</h3><pre><code>show databases； 查看所有的数据库use 库名； 打开指定 的库show tables ; 显示库中的所有表show tables from 库名;显示指定库中的所有表create table 表名(    字段名 字段类型,        字段名 字段类型); 创建表desc 表名; 查看指定表的结构select * from 表名;显示表中的所有数据</code></pre><h2 id="DQL语言的学习"><a href="#DQL语言的学习" class="headerlink" title="DQL语言的学习"></a>DQL语言的学习</h2><h3 id="进阶1：基础查询"><a href="#进阶1：基础查询" class="headerlink" title="进阶1：基础查询"></a>进阶1：基础查询</h3><pre><code>语法：SELECT 要查询的东西【FROM 表名】;类似于Java中 :System.out.println(要打印的东西);特点：①通过select查询完的结果 ，是一个虚拟的表格，不是真实存在② 要查询的东西 可以是常量值、可以是表达式、可以是字段、可以是函数</code></pre><h3 id="进阶2：条件查询"><a href="#进阶2：条件查询" class="headerlink" title="进阶2：条件查询"></a>进阶2：条件查询</h3><pre><code>条件查询：根据条件过滤原始表的数据，查询到想要的数据语法：select     要查询的字段|表达式|常量值|函数from     表where     条件 ;分类：一、条件表达式    示例：salary&gt;10000    条件运算符：    &gt; &lt; &gt;= &lt;= = != &lt;&gt;二、逻辑表达式示例：salary&gt;10000 &amp;&amp; salary&lt;20000逻辑运算符：    and（&amp;&amp;）:两个条件如果同时成立，结果为true，否则为false    or(||)：两个条件只要有一个成立，结果为true，否则为false    not(!)：如果条件成立，则not后为false，否则为true三、模糊查询示例：last_name like &#39;a%&#39;</code></pre><h3 id="进阶3：排序查询"><a href="#进阶3：排序查询" class="headerlink" title="进阶3：排序查询"></a>进阶3：排序查询</h3><pre><code>语法：select    要查询的东西from    表where     条件order by 排序的字段|表达式|函数|别名 【asc|desc】</code></pre><h3 id="进阶4：常见函数"><a href="#进阶4：常见函数" class="headerlink" title="进阶4：常见函数"></a>进阶4：常见函数</h3><pre><code>一、单行函数1、字符函数    concat拼接    substr截取子串    upper转换成大写    lower转换成小写    trim去前后指定的空格和字符    ltrim去左边空格    rtrim去右边空格    replace替换    lpad左填充    rpad右填充    instr返回子串第一次出现的索引    length 获取字节个数    2、数学函数    round 四舍五入    rand 随机数    floor向下取整    ceil向上取整    mod取余    truncate截断3、日期函数    now当前系统日期+时间    curdate当前系统日期    curtime当前系统时间    str_to_date 将字符转换成日期    date_format将日期转换成字符4、流程控制函数    if 处理双分支    case语句 处理多分支        情况1：处理等值判断        情况2：处理条件判断    5、其他函数    version版本    database当前库    user当前连接用户</code></pre><p>二、分组函数</p><pre><code>    sum 求和    max 最大值    min 最小值    avg 平均值    count 计数    特点：    1、以上五个分组函数都忽略null值，除了count(*)    2、sum和avg一般用于处理数值型        max、min、count可以处理任何数据类型    3、都可以搭配distinct使用，用于统计去重后的结果    4、count的参数可以支持：        字段、*、常量值，一般放1       建议使用 count(*)</code></pre><h2 id="进阶5：分组查询"><a href="#进阶5：分组查询" class="headerlink" title="进阶5：分组查询"></a>进阶5：分组查询</h2><pre><code>语法：select 查询的字段，分组函数from 表group by 分组的字段特点：1、可以按单个字段分组2、和分组函数一同查询的字段最好是分组后的字段3、分组筛选        针对的表    位置            关键字分组前筛选：    原始表        group by的前面        where分组后筛选：    分组后的结果集    group by的后面        having4、可以按多个字段分组，字段之间用逗号隔开5、可以支持排序6、having后可以支持别名</code></pre><h2 id="进阶6：多表连接查询"><a href="#进阶6：多表连接查询" class="headerlink" title="进阶6：多表连接查询"></a>进阶6：多表连接查询</h2><pre><code>笛卡尔乘积：如果连接条件省略或无效则会出现解决办法：添加上连接条件</code></pre><p>一、传统模式下的连接 ：等值连接——非等值连接</p><pre><code>1.等值连接的结果 = 多个表的交集2.n表连接，至少需要n-1个连接条件3.多个表不分主次，没有顺序要求4.一般为表起别名，提高阅读性和性能</code></pre><p>二、sql99语法：通过join关键字实现连接</p><pre><code>含义：1999年推出的sql语法支持：等值连接、非等值连接 （内连接）外连接交叉连接语法：select 字段，...from 表1【inner|left outer|right outer|cross】join 表2 on  连接条件【inner|left outer|right outer|cross】join 表3 on  连接条件【where 筛选条件】【group by 分组字段】【having 分组后的筛选条件】【order by 排序的字段或表达式】好处：语句上，连接条件和筛选条件实现了分离，简洁明了！</code></pre><p>三、自连接</p><p>案例：查询员工名和直接上级的名称</p><p>sql99</p><pre><code>SELECT e.last_name,m.last_nameFROM employees eJOIN employees m ON e.`manager_id`=m.`employee_id`;</code></pre><p>sql92</p><pre><code>SELECT e.last_name,m.last_nameFROM employees e,employees m WHERE e.`manager_id`=m.`employee_id`;</code></pre><h2 id="进阶7：子查询"><a href="#进阶7：子查询" class="headerlink" title="进阶7：子查询"></a>进阶7：子查询</h2><p>含义：</p><pre><code>一条查询语句中又嵌套了另一条完整的select语句，其中被嵌套的select语句，称为子查询或内查询在外面的查询语句，称为主查询或外查询</code></pre><p>特点：</p><pre><code>1、子查询都放在小括号内2、子查询可以放在from后面、select后面、where后面、having后面，但一般放在条件的右侧3、子查询优先于主查询执行，主查询使用了子查询的执行结果4、子查询根据查询结果的行数不同分为以下两类：① 单行子查询    结果集只有一行    一般搭配单行操作符使用：&gt; &lt; = &lt;&gt; &gt;= &lt;=     非法使用子查询的情况：    a、子查询的结果为一组值    b、子查询的结果为空    ② 多行子查询    结果集有多行    一般搭配多行操作符使用：any、all、in、not in    in： 属于子查询结果中的任意一个就行    any和all往往可以用其他查询代替</code></pre><h2 id="进阶8：分页查询"><a href="#进阶8：分页查询" class="headerlink" title="进阶8：分页查询"></a>进阶8：分页查询</h2><p>应用场景：</p><pre><code>实际的web项目中需要根据用户的需求提交对应的分页查询的sql语句</code></pre><p>语法：</p><pre><code>select 字段|表达式,...from 表【where 条件】【group by 分组字段】【having 条件】【order by 排序的字段】limit 【起始的条目索引，】条目数;</code></pre><p>特点：</p><pre><code>1.起始条目索引从0开始2.limit子句放在查询语句的最后3.公式：select * from  表 limit （page-1）*sizePerPage,sizePerPage假如:每页显示条目数sizePerPage要显示的页数 page</code></pre><h2 id="进阶9：联合查询"><a href="#进阶9：联合查询" class="headerlink" title="进阶9：联合查询"></a>进阶9：联合查询</h2><p>引入：<br>    union 联合、合并</p><p>语法：</p><pre><code>select 字段|常量|表达式|函数 【from 表】 【where 条件】 union 【all】select 字段|常量|表达式|函数 【from 表】 【where 条件】 union 【all】select 字段|常量|表达式|函数 【from 表】 【where 条件】 union  【all】.....select 字段|常量|表达式|函数 【from 表】 【where 条件】</code></pre><p>特点：</p><pre><code>1、多条查询语句的查询的列数必须是一致的2、多条查询语句的查询的列的类型几乎相同3、union代表去重，union all代表不去重</code></pre><h2 id="DML语言"><a href="#DML语言" class="headerlink" title="DML语言"></a>DML语言</h2><h3 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h3><p>语法：<br>    insert into 表名(字段名，…)<br>    values(值1，…);</p><p>特点：</p><pre><code>1、字段类型和值类型一致或兼容，而且一一对应2、可以为空的字段，可以不用插入值，或用null填充3、不可以为空的字段，必须插入值4、字段个数和值的个数必须一致5、字段可以省略，但默认所有字段，并且顺序和表中的存储顺序一致</code></pre><h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><p>修改单表语法：</p><pre><code>update 表名 set 字段=新值,字段=新值【where 条件】</code></pre><p>修改多表语法：</p><pre><code>update 表1 别名1,表2 别名2set 字段=新值，字段=新值where 连接条件and 筛选条件</code></pre><h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><p>方式1：delete语句 </p><p>单表的删除： ★<br>    delete from 表名 【where 筛选条件】</p><p>多表的删除：<br>    delete 别名1，别名2<br>    from 表1 别名1，表2 别名2<br>    where 连接条件<br>    and 筛选条件;</p><p>方式2：truncate语句</p><pre><code>truncate table 表名</code></pre><p>两种方式的区别【面试题】</p><pre><code>#1.truncate不能加where条件，而delete可以加where条件#2.truncate的效率高一丢丢#3.truncate 删除带自增长的列的表后，如果再插入数据，数据从1开始#delete 删除带自增长列的表后，如果再插入数据，数据从上一次的断点处开始#4.truncate删除不能回滚，delete删除可以回滚</code></pre><h2 id="DDL语句"><a href="#DDL语句" class="headerlink" title="DDL语句"></a>DDL语句</h2><h3 id="库和表的管理"><a href="#库和表的管理" class="headerlink" title="库和表的管理"></a>库和表的管理</h3><p>库的管理：</p><pre><code>一、创建库create database 库名二、删除库drop database 库名</code></pre><p>表的管理：<br>    #1.创建表</p><pre><code>CREATE TABLE IF NOT EXISTS stuinfo(    stuId INT,    stuName VARCHAR(20),    gender CHAR,    bornDate DATETIME    );DESC studentinfo;#2.修改表 alter语法：ALTER TABLE 表名 ADD|MODIFY|DROP|CHANGE COLUMN 字段名 【字段类型】;#①修改字段名ALTER TABLE studentinfo CHANGE  COLUMN sex gender CHAR;#②修改表名ALTER TABLE stuinfo RENAME [TO]  studentinfo;#③修改字段类型和列级约束ALTER TABLE studentinfo MODIFY COLUMN borndate DATE ;#④添加字段ALTER TABLE studentinfo ADD COLUMN email VARCHAR(20) first;#⑤删除字段ALTER TABLE studentinfo DROP COLUMN email;#3.删除表DROP TABLE [IF EXISTS] studentinfo;</code></pre><h3 id="常见类型"><a href="#常见类型" class="headerlink" title="常见类型"></a>常见类型</h3><pre><code>整型：    小数：    浮点型    定点型字符型：日期型：Blob类型：</code></pre><h3 id="常见约束"><a href="#常见约束" class="headerlink" title="常见约束"></a>常见约束</h3><pre><code>NOT NULLDEFAULTUNIQUECHECKPRIMARY KEYFOREIGN KEY</code></pre><h2 id="数据库事务"><a href="#数据库事务" class="headerlink" title="数据库事务"></a>数据库事务</h2><h3 id="含义"><a href="#含义" class="headerlink" title="含义"></a>含义</h3><pre><code>通过一组逻辑操作单元（一组DML——sql语句），将数据从一种状态切换到另外一种状态</code></pre><h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><pre><code>（ACID）原子性：要么都执行，要么都回滚一致性：保证数据的状态操作前和操作后保持一致隔离性：多个事务同时操作相同数据库的同一个数据时，一个事务的执行不受另外一个事务的干扰持久性：一个事务一旦提交，则数据将持久化到本地，除非其他事务对其进行修改</code></pre><p>相关步骤：</p><pre><code>1、开启事务2、编写事务的一组逻辑操作单元（多条sql语句）3、提交事务或回滚事务</code></pre><h3 id="事务的分类："><a href="#事务的分类：" class="headerlink" title="事务的分类："></a>事务的分类：</h3><p>隐式事务，没有明显的开启和结束事务的标志</p><pre><code>比如insert、update、delete语句本身就是一个事务</code></pre><p>显式事务，具有明显的开启和结束事务的标志</p><pre><code>    1、开启事务    取消自动提交事务的功能        2、编写事务的一组逻辑操作单元（多条sql语句）    insert    update    delete        3、提交事务或回滚事务</code></pre><h3 id="使用到的关键字"><a href="#使用到的关键字" class="headerlink" title="使用到的关键字"></a>使用到的关键字</h3><pre><code>set autocommit=0;start transaction;commit;rollback;savepoint  断点commit to 断点rollback to 断点</code></pre><h3 id="事务的隔离级别"><a href="#事务的隔离级别" class="headerlink" title="事务的隔离级别:"></a>事务的隔离级别:</h3><p>事务并发问题如何发生？</p><pre><code>当多个事务同时操作同一个数据库的相同数据时</code></pre><p>事务的并发问题有哪些？</p><pre><code>脏读：一个事务读取到了另外一个事务未提交的数据不可重复读：同一个事务中，多次读取到的数据不一致幻读：一个事务读取数据时，另外一个事务进行更新，导致第一个事务读取到了没有更新的数据</code></pre><p>如何避免事务的并发问题？</p><pre><code>通过设置事务的隔离级别1、READ UNCOMMITTED2、READ COMMITTED 可以避免脏读3、REPEATABLE READ 可以避免脏读、不可重复读和一部分幻读4、SERIALIZABLE可以避免脏读、不可重复读和幻读</code></pre><p>设置隔离级别：</p><pre><code>set session|global  transaction isolation level 隔离级别名;</code></pre><p>查看隔离级别：</p><pre><code>select @@tx_isolation;</code></pre><h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p>含义：理解成一张虚拟的表</p><p>视图和表的区别：</p><pre><code>    使用方式    占用物理空间视图    完全相同    不占用，仅仅保存的是sql逻辑表    完全相同    占用</code></pre><p>视图的好处：</p><pre><code>1、sql语句提高重用性，效率高2、和表实现了分离，提高了安全性</code></pre><h3 id="视图的创建"><a href="#视图的创建" class="headerlink" title="视图的创建"></a>视图的创建</h3><pre><code>语法：CREATE VIEW  视图名AS查询语句;</code></pre><h3 id="视图的增删改查"><a href="#视图的增删改查" class="headerlink" title="视图的增删改查"></a>视图的增删改查</h3><pre><code>1、查看视图的数据 ★SELECT * FROM my_v4;SELECT * FROM my_v1 WHERE last_name=&#39;Partners&#39;;2、插入视图的数据INSERT INTO my_v4(last_name,department_id) VALUES(&#39;虚竹&#39;,90);3、修改视图的数据UPDATE my_v4 SET last_name =&#39;梦姑&#39; WHERE last_name=&#39;虚竹&#39;;4、删除视图的数据DELETE FROM my_v4;</code></pre><h3 id="某些视图不能更新"><a href="#某些视图不能更新" class="headerlink" title="某些视图不能更新"></a>某些视图不能更新</h3><pre><code>包含以下关键字的sql语句：分组函数、distinct、group  by、having、union或者union all常量视图Select中包含子查询joinfrom一个不能更新的视图where子句的子查询引用了from子句中的表</code></pre><h3 id="视图逻辑的更新"><a href="#视图逻辑的更新" class="headerlink" title="视图逻辑的更新"></a>视图逻辑的更新</h3><pre><code>#方式一：CREATE OR REPLACE VIEW test_v7ASSELECT last_name FROM employeesWHERE employee_id&gt;100;#方式二:ALTER VIEW test_v7ASSELECT employee_id FROM employees;SELECT * FROM test_v7;</code></pre><h3 id="视图的删除"><a href="#视图的删除" class="headerlink" title="视图的删除"></a>视图的删除</h3><pre><code>DROP VIEW test_v1,test_v2,test_v3;</code></pre><h3 id="视图结构的查看"><a href="#视图结构的查看" class="headerlink" title="视图结构的查看"></a>视图结构的查看</h3><pre><code>DESC test_v7;SHOW CREATE VIEW test_v7;</code></pre><h2 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h2><p>含义：一组经过预先编译的sql语句的集合<br>好处：</p><pre><code>1、提高了sql语句的重用性，减少了开发程序员的压力2、提高了效率3、减少了传输次数</code></pre><p>分类：</p><pre><code>1、无返回无参2、仅仅带in类型，无返回有参3、仅仅带out类型，有返回无参4、既带in又带out，有返回有参5、带inout，有返回有参注意：in、out、inout都可以在一个存储过程中带多个</code></pre><h3 id="创建存储过程"><a href="#创建存储过程" class="headerlink" title="创建存储过程"></a>创建存储过程</h3><p>语法：</p><pre><code>create procedure 存储过程名(in|out|inout 参数名  参数类型,...)begin    存储过程体end</code></pre><p>类似于方法：</p><pre><code>修饰符 返回类型 方法名(参数类型 参数名,...)&#123;    方法体;&#125;</code></pre><p>注意</p><pre><code>1、需要设置新的结束标记delimiter 新的结束标记示例：delimiter $CREATE PROCEDURE 存储过程名(IN|OUT|INOUT 参数名  参数类型,...)BEGIN    sql语句1;    sql语句2;END $2、存储过程体中可以有多条sql语句，如果仅仅一条sql语句，则可以省略begin end3、参数前面的符号的意思in:该参数只能作为输入 （该参数不能做返回值）out：该参数只能作为输出（该参数只能做返回值）inout：既能做输入又能做输出</code></pre><h1 id="调用存储过程"><a href="#调用存储过程" class="headerlink" title="调用存储过程"></a>调用存储过程</h1><pre><code>call 存储过程名(实参列表)</code></pre><h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="创建函数"><a href="#创建函数" class="headerlink" title="创建函数"></a>创建函数</h3><p>学过的函数：LENGTH、SUBSTR、CONCAT等<br>语法：</p><pre><code>CREATE FUNCTION 函数名(参数名 参数类型,...) RETURNS 返回类型BEGIN    函数体END</code></pre><h3 id="调用函数"><a href="#调用函数" class="headerlink" title="调用函数"></a>调用函数</h3><pre><code>SELECT 函数名（实参列表）</code></pre><h3 id="函数和存储过程的区别"><a href="#函数和存储过程的区别" class="headerlink" title="函数和存储过程的区别"></a>函数和存储过程的区别</h3><pre><code>        关键字        调用语法    返回值            应用场景函数        FUNCTION    SELECT 函数()    只能是一个        一般用于查询结果为一个值并返回时，当有返回值而且仅仅一个存储过程    PROCEDURE    CALL 存储过程()    可以有0个或多个        一般用于更新</code></pre><h2 id="流程控制结构"><a href="#流程控制结构" class="headerlink" title="流程控制结构"></a>流程控制结构</h2><h3 id="系统变量"><a href="#系统变量" class="headerlink" title="系统变量"></a>系统变量</h3><p>一、全局变量</p><p>作用域：针对于所有会话（连接）有效，但不能跨重启</p><pre><code>查看所有全局变量SHOW GLOBAL VARIABLES;查看满足条件的部分系统变量SHOW GLOBAL VARIABLES LIKE &#39;%char%&#39;;查看指定的系统变量的值SELECT @@global.autocommit;为某个系统变量赋值SET @@global.autocommit=0;SET GLOBAL autocommit=0;</code></pre><p>二、会话变量</p><p>作用域：针对于当前会话（连接）有效</p><pre><code>查看所有会话变量SHOW SESSION VARIABLES;查看满足条件的部分会话变量SHOW SESSION VARIABLES LIKE &#39;%char%&#39;;查看指定的会话变量的值SELECT @@autocommit;SELECT @@session.tx_isolation;为某个会话变量赋值SET @@session.tx_isolation=&#39;read-uncommitted&#39;;SET SESSION tx_isolation=&#39;read-committed&#39;;</code></pre><h3 id="自定义变量"><a href="#自定义变量" class="headerlink" title="自定义变量"></a>自定义变量</h3><p>一、用户变量</p><p>声明并初始化：</p><pre><code>SET @变量名=值;SET @变量名:=值;SELECT @变量名:=值;</code></pre><p>赋值：</p><pre><code>方式一：一般用于赋简单的值SET 变量名=值;SET 变量名:=值;SELECT 变量名:=值;方式二：一般用于赋表 中的字段值SELECT 字段名或表达式 INTO 变量FROM 表;</code></pre><p>使用：</p><pre><code>select @变量名;</code></pre><p>二、局部变量</p><p>声明：</p><pre><code>declare 变量名 类型 【default 值】;</code></pre><p>赋值：</p><pre><code>方式一：一般用于赋简单的值SET 变量名=值;SET 变量名:=值;SELECT 变量名:=值;方式二：一般用于赋表 中的字段值SELECT 字段名或表达式 INTO 变量FROM 表;</code></pre><p>使用：</p><pre><code>select 变量名</code></pre><p>二者的区别：</p><pre><code>        作用域            定义位置        语法</code></pre><p>用户变量    当前会话        会话的任何地方        加@符号，不用指定类型<br>局部变量    定义它的BEGIN END中     BEGIN END的第一句话    一般不用加@,需要指定类型</p><h3 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h3><p>一、if函数<br>    语法：if(条件，值1，值2)<br>    特点：可以用在任何位置</p><p>二、case语句</p><p>语法：</p><pre><code>情况一：类似于switchcase 表达式when 值1 then 结果1或语句1(如果是语句，需要加分号) when 值2 then 结果2或语句2(如果是语句，需要加分号)...else 结果n或语句n(如果是语句，需要加分号)end 【case】（如果是放在begin end中需要加上case，如果放在select后面不需要）情况二：类似于多重ifcase when 条件1 then 结果1或语句1(如果是语句，需要加分号) when 条件2 then 结果2或语句2(如果是语句，需要加分号)...else 结果n或语句n(如果是语句，需要加分号)end 【case】（如果是放在begin end中需要加上case，如果放在select后面不需要）</code></pre><p>特点：<br>    可以用在任何位置</p><p>三、if elseif语句</p><p>语法：</p><pre><code>if 情况1 then 语句1;elseif 情况2 then 语句2;...else 语句n;end if;</code></pre><p>特点：<br>    只能用在begin end中！！！！！！！！！！！！！！！</p><p>三者比较：<br>            应用场合<br>    if函数        简单双分支<br>    case结构    等值判断 的多分支<br>    if结构        区间判断 的多分支</p><h3 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h3><p>语法：</p><pre><code>【标签：】WHILE 循环条件  DO    循环体END WHILE 【标签】;</code></pre><p>特点：</p><pre><code>只能放在BEGIN END里面如果要搭配leave跳转语句，需要使用标签，否则可以不用标签leave类似于java中的break语句，跳出所在循环！！！</code></pre>]]></content>
      
      
      <categories>
          
          <category> SQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2021/11/16/hello-world/"/>
      <url>/2021/11/16/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
